import{r as c,j as e}from"./react-BLQlKNq_.js";import{u as K}from"./notistack-DWKSkMQ9.js";import{a as x}from"./index-DZ2TZcCs.js";import{B,b as t,af as o,v as w,ag as C,l as X,o as j,I as g,ah as _,ai as Y,P as Z,w as ee,x as re,j as te,T as f,a as l,C as N,y as ae,aj as q,ak as se,al as ie,z as ne,am as le,an as oe,ao as de,ap as ce,F as z}from"./@mui-Bw2wRnxu.js";import"./@babel-HOuxngs4.js";import"./react-dom-DmmE3xc2.js";import"./scheduler-CzFDRTuY.js";import"./goober-DovPBWGu.js";import"./react-router-dom-BCp3cZHX.js";import"./react-router-CeklShVs.js";import"./@remix-run-CbFatO5U.js";import"./react-redux-10GvvXuy.js";import"./use-sync-external-store-De7g8zNk.js";import"./axios-Cm0UX6qg.js";import"./@reduxjs-DVdFRU_h.js";import"./redux-DITMfSWq.js";import"./immer-BWU1mfoO.js";import"./reselect-BeKUwQU7.js";import"./redux-thunk-ClJT1hhx.js";import"./react-typed-DYA10Kre.js";import"./typed.js-exEGtOgn.js";import"./react-bootstrap-sweetalert-DQB2ynYp.js";import"./prop-types-C1xvqhu3.js";import"./swiper-DTKdPQEP.js";import"./fslightbox-react-CQdsEJ3s.js";import"./yet-another-react-lightbox-DocsD2co.js";import"./react-bootstrap-C0bN-j8n.js";import"./classnames-BfIYw_zE.js";import"./@restart-JOvkJ3VN.js";import"./dom-helpers-nL1pTuZz.js";import"./react-transition-group-DSzsIoyj.js";import"./react-lazyload-DZ8paPqQ.js";import"./react-loading-skeleton-D7jF0Q-E.js";import"./@emotion-C2ZuPDAx.js";import"./hoist-non-react-statics-Buxaj0Kl.js";import"./react-is-8JwjhRSi.js";import"./stylis-NkKAe6Bn.js";import"./clsx-B-dksMZM.js";import"./@popperjs-BQBsAJpH.js";const he=[{id:"select",label:"",minWidth:50,align:"center"},{id:"name",label:"Username",minWidth:120},{id:"email",label:"Email",minWidth:170},{id:"question",label:"Question",minWidth:200},{id:"msg",label:"Message",minWidth:200},{id:"isRead",label:"Status",minWidth:100,align:"center"},{id:"createdAt",label:"Date",minWidth:130},{id:"actions",label:"Actions",minWidth:150,align:"center"}];function Xe(){const[v,S]=c.useState(0),[y,F]=c.useState(10),[I,D]=c.useState(!1),[i,P]=c.useState(null),[h,U]=c.useState([]),[m,d]=c.useState(!1),[u,b]=c.useState(!1),[s,p]=c.useState([]),[R,$]=c.useState({total:0,unread:0,read:0}),{enqueueSnackbar:n}=K(),H=(r,a)=>{S(a)},O=r=>{F(+r.target.value),S(0)},T=r=>{P(r),D(!0)},A=()=>{D(!1),P(null)},Q=r=>{r.target.checked?p(h.map(a=>a._id)):p([])},L=r=>{p(a=>a.includes(r)?a.filter(k=>k!==r):[...a,r])},M=async r=>{d(!0);try{await x.get(`/report/${r}`),n("Report marked as read",{variant:"success"}),b(!u)}catch(a){n("Failed to mark report as read",{variant:"error"}),console.error("Error marking report as read:",a)}finally{d(!1)}},V=async()=>{if(s.length===0){n("Please select reports to mark as read",{variant:"warning"});return}d(!0);try{await x.patch("/report/mark-read",{reportIds:s}),n(`${s.length} reports marked as read`,{variant:"success"}),p([]),b(!u)}catch(r){n("Failed to mark reports as read",{variant:"error"}),console.error("Error marking reports as read:",r)}finally{d(!1)}},G=async r=>{if(window.confirm("Are you sure you want to delete this report?")){d(!0);try{await x.delete(`/report/${r}`),n("Report deleted successfully",{variant:"success"}),b(!u)}catch(a){n("Failed to delete report",{variant:"error"}),console.error("Error deleting report:",a)}finally{d(!1)}}},J=async()=>{if(s.length===0){n("Please select reports to delete",{variant:"warning"});return}if(window.confirm(`Are you sure you want to delete ${s.length} reports?`)){d(!0);try{await x.delete("/report",{data:{reportIds:s}}),n(`${s.length} reports deleted successfully`,{variant:"success"}),p([]),b(!u)}catch(r){n("Failed to delete reports",{variant:"error"}),console.error("Error deleting reports:",r)}finally{d(!1)}}},W=r=>r?new Date(r).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",E=(r,a=50)=>r?r.length>a?r.substring(0,a)+"...":r:"N/A";return c.useEffect(()=>{(async()=>{d(!0);try{const[a,k]=await Promise.all([x.get("/report"),x.get("/report/stats/overview")]);U(a.data||[]),$(k.data||{total:0,unread:0,read:0})}catch(a){n("Failed to fetch reports",{variant:"error"}),console.error("Error fetching data:",a)}finally{d(!1)}})()},[u,n]),e.jsxs(B,{sx:{p:3},children:[e.jsx(t,{variant:"h4",gutterBottom:!0,children:"MCQ Reports Management"}),e.jsxs(o,{container:!0,spacing:3,sx:{mb:3},children:[e.jsx(o,{item:!0,xs:12,md:4,children:e.jsx(w,{children:e.jsxs(C,{children:[e.jsx(t,{variant:"h6",color:"primary",children:"Total Reports"}),e.jsx(t,{variant:"h4",children:R.total})]})})}),e.jsx(o,{item:!0,xs:12,md:4,children:e.jsx(w,{children:e.jsxs(C,{children:[e.jsx(t,{variant:"h6",color:"warning.main",children:"Unread Reports"}),e.jsx(t,{variant:"h4",children:R.unread})]})})}),e.jsx(o,{item:!0,xs:12,md:4,children:e.jsx(w,{children:e.jsxs(C,{children:[e.jsx(t,{variant:"h6",color:"success.main",children:"Read Reports"}),e.jsx(t,{variant:"h4",children:R.read})]})})})]}),s.length>0&&e.jsxs(X,{sx:{mb:2,bgcolor:"primary.light",borderRadius:1},children:[e.jsxs(t,{variant:"h6",sx:{flex:"1 1 100%",color:"primary.contrastText"},children:[s.length," selected"]}),e.jsx(j,{title:"Mark as Read",children:e.jsx(g,{onClick:V,disabled:m,sx:{color:"primary.contrastText"},children:e.jsx(_,{})})}),e.jsx(j,{title:"Delete Selected",children:e.jsx(g,{onClick:J,disabled:m,sx:{color:"primary.contrastText"},children:e.jsx(Y,{})})})]}),e.jsxs(Z,{sx:{width:"100%",overflow:"hidden"},children:[e.jsx(ee,{sx:{maxHeight:600},children:e.jsxs(re,{stickyHeader:!0,"aria-label":"reports table",children:[e.jsx(te,{children:e.jsxs(f,{children:[e.jsx(l,{padding:"checkbox",children:e.jsx(N,{indeterminate:s.length>0&&s.length<h.length,checked:h.length>0&&s.length===h.length,onChange:Q})}),he.slice(1).map(r=>e.jsx(l,{align:r.align,style:{minWidth:r.minWidth,fontWeight:"bold"},children:r.label},r.id))]})}),e.jsx(ae,{children:m?e.jsx(f,{children:e.jsx(l,{colSpan:8,align:"center",sx:{py:4},children:e.jsx(t,{children:"Loading reports..."})})}):h.length===0?e.jsx(f,{children:e.jsx(l,{colSpan:8,align:"center",sx:{py:4},children:e.jsx(t,{color:"text.secondary",children:"No reports found"})})}):h.slice(v*y,v*y+y).map(r=>e.jsxs(f,{hover:!0,role:"checkbox",tabIndex:-1,selected:s.includes(r._id),children:[e.jsx(l,{padding:"checkbox",children:e.jsx(N,{checked:s.includes(r._id),onChange:()=>L(r._id)})}),e.jsx(l,{children:r.username||r.name||"Anonymous"}),e.jsx(l,{children:r.email||"N/A"}),e.jsx(l,{children:e.jsx(t,{variant:"body2",children:E(r.question,60)})}),e.jsx(l,{children:e.jsx(t,{variant:"body2",sx:{cursor:"pointer",color:"primary.main"},onClick:()=>T(r),children:E(r.msg,40)})}),e.jsx(l,{align:"center",children:e.jsx(q,{label:r.isRead?"Read":"Unread",color:r.isRead?"success":"warning",size:"small"})}),e.jsx(l,{children:e.jsx(t,{variant:"body2",children:W(r.createdAt)})}),e.jsxs(l,{align:"center",children:[e.jsx(j,{title:"View Details",children:e.jsx(g,{onClick:()=>T(r),size:"small",children:e.jsx(se,{})})}),!r.isRead&&e.jsx(j,{title:"Mark as Read",children:e.jsx(g,{onClick:()=>M(r._id),disabled:m,size:"small",color:"primary",children:e.jsx(_,{})})}),e.jsx(j,{title:"Delete",children:e.jsx(g,{onClick:()=>G(r._id),disabled:m,size:"small",color:"error",children:e.jsx(ie,{})})})]})]},r._id))})]})}),e.jsx(ne,{rowsPerPageOptions:[10,25,50,100],component:"div",count:h.length,rowsPerPage:y,page:v,onPageChange:H,onRowsPerPageChange:O})]}),e.jsxs(le,{open:I,onClose:A,maxWidth:"md",fullWidth:!0,children:[e.jsx(oe,{sx:{bgcolor:"primary.main",color:"primary.contrastText"},children:"Report Details"}),e.jsx(de,{sx:{mt:2},children:i&&e.jsx(B,{children:e.jsxs(o,{container:!0,spacing:2,children:[e.jsxs(o,{item:!0,xs:12,md:6,children:[e.jsx(t,{variant:"subtitle2",color:"text.secondary",children:"Reporter:"}),e.jsx(t,{variant:"body1",gutterBottom:!0,children:i.username||i.name||"Anonymous"})]}),e.jsxs(o,{item:!0,xs:12,md:6,children:[e.jsx(t,{variant:"subtitle2",color:"text.secondary",children:"Email:"}),e.jsx(t,{variant:"body1",gutterBottom:!0,children:i.email||"N/A"})]}),e.jsxs(o,{item:!0,xs:12,md:6,children:[e.jsx(t,{variant:"subtitle2",color:"text.secondary",children:"Status:"}),e.jsx(q,{label:i.isRead?"Read":"Unread",color:i.isRead?"success":"warning",size:"small"})]}),e.jsxs(o,{item:!0,xs:12,md:6,children:[e.jsx(t,{variant:"subtitle2",color:"text.secondary",children:"Date:"}),e.jsx(t,{variant:"body1",gutterBottom:!0,children:W(i.createdAt)})]}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx(t,{variant:"subtitle2",color:"text.secondary",children:"Question:"}),e.jsx(t,{variant:"body1",gutterBottom:!0,sx:{p:2,bgcolor:"grey.100",borderRadius:1},children:i.question||"No question provided"})]}),e.jsxs(o,{item:!0,xs:12,children:[e.jsx(t,{variant:"subtitle2",color:"text.secondary",children:"Message:"}),e.jsx(t,{variant:"body1",sx:{p:2,bgcolor:"grey.100",borderRadius:1},children:i.msg||"No message provided"})]})]})})}),e.jsxs(ce,{children:[i&&!i.isRead&&e.jsx(z,{onClick:()=>M(i._id),disabled:m,color:"primary",variant:"contained",children:"Mark as Read"}),e.jsx(z,{onClick:A,color:"primary",children:"Close"})]})]})]})}export{Xe as default};
