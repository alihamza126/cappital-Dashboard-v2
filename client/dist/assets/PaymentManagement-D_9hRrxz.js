import{r as o,j as e}from"./react-BLQlKNq_.js";import{u as he}from"./notistack-DWKSkMQ9.js";import{a as p}from"./index-B50ReYK6.js";import{F as y,a8 as xe,al as t,v as z,am as $,b as i,G as g,H as C,J as I,f,w as me,P as pe,x as je,j as fe,T as J,a as l,y as ve,B as b,A as ye,an as V,I as q,aj as ge,ao as Ce,ap as Ie,af as Q,ag as X,ah as Y,R as D,ai as Z,ad as be,aH as Se,aD as Pe,aG as Ae}from"./@mui-DAjQFfGe.js";import"./@babel-HOuxngs4.js";import"./react-dom-DmmE3xc2.js";import"./scheduler-CzFDRTuY.js";import"./goober-DovPBWGu.js";import"./react-router-dom-BCp3cZHX.js";import"./react-router-CeklShVs.js";import"./@remix-run-CbFatO5U.js";import"./react-redux-10GvvXuy.js";import"./use-sync-external-store-De7g8zNk.js";import"./axios-Cm0UX6qg.js";import"./@reduxjs-DVdFRU_h.js";import"./redux-DITMfSWq.js";import"./immer-BWU1mfoO.js";import"./reselect-BeKUwQU7.js";import"./redux-thunk-ClJT1hhx.js";import"./react-typed-DYA10Kre.js";import"./typed.js-exEGtOgn.js";import"./react-bootstrap-sweetalert-DQB2ynYp.js";import"./prop-types-C1xvqhu3.js";import"./swiper-DTKdPQEP.js";import"./fslightbox-react-CQdsEJ3s.js";import"./react-bootstrap-C0bN-j8n.js";import"./classnames-BfIYw_zE.js";import"./@restart-JOvkJ3VN.js";import"./dom-helpers-nL1pTuZz.js";import"./react-transition-group-DSzsIoyj.js";import"./react-lazyload-DZ8paPqQ.js";import"./react-loading-skeleton-D7jF0Q-E.js";import"./@emotion-C2ZuPDAx.js";import"./hoist-non-react-statics-Buxaj0Kl.js";import"./react-is-8JwjhRSi.js";import"./stylis-NkKAe6Bn.js";import"./clsx-B-dksMZM.js";import"./@popperjs-BQBsAJpH.js";const us=()=>{const[R,O]=o.useState([]),[j,ee]=o.useState([]),[v,se]=o.useState([]),[G,x]=o.useState(!1),[re,H]=o.useState(!1),[S,_]=o.useState(null),[n,P]=o.useState(null),[c,te]=o.useState(""),[A,ie]=o.useState({}),{enqueueSnackbar:u}=he(),[r,h]=o.useState({userId:"",seriesId:"",currency:"PKR",amount:"",couponCode:"",discountApplied:"",status:"created",provider:"manual",providerRef:""}),[m,T]=o.useState({}),k=["created","processing","paid","failed","canceled","refunded"],U=["stripe","manual"];o.useEffect(()=>{ne(),ae(),F()},[]),o.useEffect(()=>{c?W(c):E()},[c]);const ne=async()=>{try{const s=await p.get("/series/all");ee(s.data)}catch{u("Failed to fetch series",{variant:"error"})}},ae=async()=>{try{const s=await p.get("/user");se(s.data||[])}catch{u("Failed to fetch users",{variant:"error"})}},W=async s=>{try{x(!0);const a=await p.get(`/payments/series/${s}`);O(a.data)}catch{u("Failed to fetch payments",{variant:"error"})}finally{x(!1)}},E=async()=>{try{x(!0);const s=await p.get("/payments/all");O(s.data)}catch{u("Failed to fetch payments",{variant:"error"})}finally{x(!1)}},F=async()=>{try{const s=await p.get("/payments/stats/overview");ie(s.data)}catch{u("Failed to fetch statistics",{variant:"error"})}},K=(s=null)=>{s?(_(s),h({userId:s.userId._id||s.userId,seriesId:s.seriesId._id||s.seriesId,currency:s.currency,amount:s.amount,couponCode:s.couponCode||"",discountApplied:s.discountApplied||"",status:s.status,provider:s.provider,providerRef:s.providerRef||""})):(_(null),h({userId:"",seriesId:c||"",currency:"PKR",amount:"",couponCode:"",discountApplied:"",status:"created",provider:"manual",providerRef:""})),T({}),H(!0)},N=()=>{H(!1),_(null),T({})},le=()=>{const s={};return r.userId||(s.userId="User is required"),r.seriesId||(s.seriesId="Series is required"),r.amount||(s.amount="Amount is required"),T(s),Object.keys(s).length===0},oe=async()=>{var s,a;if(le())try{x(!0);const d={...r,amount:Number(r.amount),discountApplied:r.discountApplied?Number(r.discountApplied):0};S?(await p.put(`/payments/${S._id}`,d),u("Payment updated successfully",{variant:"success"})):(await p.post("/payments",d),u("Payment created successfully",{variant:"success"})),N(),c?W(c):E(),F()}catch(d){u(((a=(s=d.response)==null?void 0:s.data)==null?void 0:a.error)||"Operation failed",{variant:"error"})}finally{x(!1)}},de=async s=>{if(window.confirm("Are you sure you want to delete this payment? This action cannot be undone."))try{x(!0),await p.delete(`/payments/${s}`),u("Payment deleted successfully",{variant:"success"}),c?W(c):E(),F()}catch{u("Failed to delete payment",{variant:"error"})}finally{x(!1)}},w=(s,a,d,ue)=>e.jsx(z,{sx:{minWidth:275,bgcolor:ue},children:e.jsx($,{children:e.jsxs(b,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(b,{children:[e.jsx(i,{variant:"h6",component:"div",color:"white",children:s}),e.jsx(i,{variant:"h4",component:"div",color:"white",children:a})]}),e.jsx(b,{color:"white",children:d})]})})}),ce=s=>{switch(s){case"paid":return"success";case"processing":return"warning";case"failed":return"error";case"canceled":return"default";case"refunded":return"info";default:return"default"}},B=s=>{const a=v.find(d=>d._id===s);return a?a.username:"Unknown User"},M=s=>{const a=v.find(d=>d._id===s);return a?a.email:"Unknown Email"},L=s=>{const a=j.find(d=>d._id===s);return a?a.title:"Unknown Series"};return e.jsxs("div",{className:"container-fluid",children:[e.jsxs("div",{className:"d-sm-flex align-items-center justify-content-between mb-4",children:[e.jsx("h1",{className:"h3 mb-0 text-gray-800",children:"Payment Management"}),e.jsx(y,{variant:"contained",startIcon:e.jsx(xe,{}),onClick:()=>K(),sx:{bgcolor:"#4e73df"},children:"Add New Payment"})]}),e.jsxs(t,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(t,{item:!0,xs:12,sm:6,md:3,children:w("Total Payments",A.totalPayments||0,e.jsx(be,{}),"#4e73df")}),e.jsx(t,{item:!0,xs:12,sm:6,md:3,children:w("Paid Payments",A.paidPayments||0,e.jsx(Se,{}),"#1cc88a")}),e.jsx(t,{item:!0,xs:12,sm:6,md:3,children:w("Pending Payments",A.pendingPayments||0,e.jsx(Pe,{}),"#f6c23e")}),e.jsx(t,{item:!0,xs:12,sm:6,md:3,children:w("Total Revenue",`PKR ${(A.totalRevenue||0).toLocaleString()}`,e.jsx(Ae,{}),"#e74a3b")})]}),e.jsx(z,{sx:{mb:4},children:e.jsxs($,{children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"Filter by Series"}),e.jsxs(g,{fullWidth:!0,children:[e.jsx(C,{children:"Choose Series"}),e.jsxs(I,{value:c,onChange:s=>te(s.target.value),children:[e.jsx(f,{value:"",children:"All Series"}),j==null?void 0:j.map(s=>e.jsx(f,{value:s._id,children:s.title},s._id))]})]})]})}),e.jsx(z,{children:e.jsxs($,{children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:c?`Payments for ${L(c)}`:"All Payments"}),e.jsx(me,{component:pe,children:e.jsxs(je,{children:[e.jsx(fe,{children:e.jsxs(J,{children:[e.jsx(l,{children:"Customer"}),e.jsx(l,{children:"Series"}),e.jsx(l,{children:"Amount"}),e.jsx(l,{children:"Status"}),e.jsx(l,{children:"Provider"}),e.jsx(l,{children:"Date"}),e.jsx(l,{children:"Actions"})]})}),e.jsx(ve,{children:R==null?void 0:R.map(s=>e.jsxs(J,{children:[e.jsx(l,{children:e.jsxs(b,{display:"flex",alignItems:"center",children:[e.jsx(ye,{sx:{mr:2,width:32,height:32},children:B(s.userId._id||s.userId).charAt(0).toUpperCase()}),e.jsxs(b,{children:[e.jsx(i,{variant:"body2",children:B(s.userId._id||s.userId)}),e.jsx(i,{variant:"caption",color:"textSecondary",children:M(s.userId._id||s.userId)})]})]})}),e.jsx(l,{children:e.jsx(i,{variant:"body2",children:L(s.seriesId._id||s.seriesId)})}),e.jsxs(l,{children:[e.jsxs(i,{variant:"body2",children:["PKR ",s.amount.toLocaleString()]}),s.discountApplied>0&&e.jsxs(i,{variant:"caption",color:"textSecondary",children:["Discount: PKR ",s.discountApplied]})]}),e.jsx(l,{children:e.jsx(V,{label:s.status,color:ce(s.status),size:"small"})}),e.jsx(l,{children:e.jsx(V,{label:s.provider,size:"small",variant:"outlined"})}),e.jsx(l,{children:new Date(s.createdAt).toLocaleDateString()}),e.jsxs(l,{children:[e.jsx(q,{size:"small",onClick:()=>P(s),color:"primary",children:e.jsx(ge,{})}),e.jsx(q,{size:"small",onClick:()=>K(s),color:"primary",children:e.jsx(Ce,{})}),e.jsx(q,{size:"small",onClick:()=>de(s._id),color:"error",children:e.jsx(Ie,{})})]})]},s._id))})]})})]})}),e.jsxs(Q,{open:re,onClose:N,maxWidth:"md",fullWidth:!0,children:[e.jsx(X,{children:S?"Edit Payment":"Add New Payment"}),e.jsx(Y,{children:e.jsxs(t,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsxs(g,{fullWidth:!0,error:!!m.userId,children:[e.jsx(C,{children:"User"}),e.jsx(I,{value:r.userId,onChange:s=>h({...r,userId:s.target.value}),children:v==null?void 0:v.map(s=>e.jsxs(f,{value:s._id,children:[s.username," (",s.email,")"]},s._id))}),m.userId&&e.jsx(i,{variant:"caption",color:"error",children:m.userId})]})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsxs(g,{fullWidth:!0,error:!!m.seriesId,children:[e.jsx(C,{children:"Series"}),e.jsx(I,{value:r.seriesId,onChange:s=>h({...r,seriesId:s.target.value}),children:j==null?void 0:j.map(s=>e.jsx(f,{value:s._id,children:s.title},s._id))}),m.seriesId&&e.jsx(i,{variant:"caption",color:"error",children:m.seriesId})]})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsx(D,{fullWidth:!0,label:"Amount (PKR)",type:"number",value:r.amount,onChange:s=>h({...r,amount:s.target.value}),error:!!m.amount,helperText:m.amount})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsx(D,{fullWidth:!0,label:"Discount Applied (PKR)",type:"number",value:r.discountApplied,onChange:s=>h({...r,discountApplied:s.target.value})})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsx(D,{fullWidth:!0,label:"Coupon Code",value:r.couponCode,onChange:s=>h({...r,couponCode:s.target.value})})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsxs(g,{fullWidth:!0,children:[e.jsx(C,{children:"Status"}),e.jsx(I,{value:r.status,onChange:s=>h({...r,status:s.target.value}),children:k==null?void 0:k.map(s=>e.jsx(f,{value:s,children:s.charAt(0).toUpperCase()+s.slice(1)},s))})]})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsxs(g,{fullWidth:!0,children:[e.jsx(C,{children:"Provider"}),e.jsx(I,{value:r.provider,onChange:s=>h({...r,provider:s.target.value}),children:U==null?void 0:U.map(s=>e.jsx(f,{value:s,children:s.charAt(0).toUpperCase()+s.slice(1)},s))})]})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsx(D,{fullWidth:!0,label:"Provider Reference",value:r.providerRef,onChange:s=>h({...r,providerRef:s.target.value})})})]})}),e.jsxs(Z,{children:[e.jsx(y,{onClick:N,children:"Cancel"}),e.jsx(y,{onClick:oe,variant:"contained",disabled:G,sx:{bgcolor:"#4e73df"},children:G?"Saving...":S?"Update":"Create"})]})]}),e.jsx(Q,{open:!!n,onClose:()=>P(null),maxWidth:"md",fullWidth:!0,children:n&&e.jsxs(e.Fragment,{children:[e.jsx(X,{children:"Payment Details"}),e.jsx(Y,{children:e.jsxs(t,{container:!0,spacing:2,children:[e.jsxs(t,{item:!0,xs:12,children:[e.jsx(i,{variant:"h6",children:"Customer Information"}),e.jsxs(i,{variant:"body2",children:["Name: ",B(n.userId._id||n.userId)]}),e.jsxs(i,{variant:"body2",children:["Email: ",M(n.userId._id||n.userId)]})]}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(i,{variant:"h6",children:"Series Information"}),e.jsxs(i,{variant:"body2",children:["Series: ",L(n.seriesId._id||n.seriesId)]})]}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsxs(i,{variant:"subtitle2",children:["Amount: PKR ",n.amount.toLocaleString()]})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsxs(i,{variant:"subtitle2",children:["Status: ",n.status]})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsxs(i,{variant:"subtitle2",children:["Provider: ",n.provider]})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsxs(i,{variant:"subtitle2",children:["Date: ",new Date(n.createdAt).toLocaleDateString()]})}),n.couponCode&&e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsxs(i,{variant:"subtitle2",children:["Coupon: ",n.couponCode]})}),n.discountApplied>0&&e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsxs(i,{variant:"subtitle2",children:["Discount: PKR ",n.discountApplied]})})]})}),e.jsxs(Z,{children:[e.jsx(y,{onClick:()=>P(null),children:"Close"}),e.jsx(y,{onClick:()=>{P(null),K(n)},variant:"contained",sx:{bgcolor:"#4e73df"},children:"Edit"})]})]})})]})};export{us as default};
