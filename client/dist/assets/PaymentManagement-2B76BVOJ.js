import{r as o,j as e}from"./react-BLQlKNq_.js";import{u as he}from"./notistack-DWKSkMQ9.js";import{a as p}from"./index-BZIQzIKv.js";import{F as f,a8 as xe,al as t,v as N,am as B,b as i,G as v,H as y,J as g,f as j,w as me,P as pe,x as je,j as fe,T as M,a as l,y as ve,B as C,A as ye,an as G,I as L,aj as ge,ao as Ce,ap as Ie,af as H,ag as J,ah as V,R as A,ai as Q,ad as be,ax as Se,au as Pe,aw as Ae}from"./@mui-JR0bzeok.js";import"./@babel-HOuxngs4.js";import"./react-dom-DmmE3xc2.js";import"./scheduler-CzFDRTuY.js";import"./goober-DovPBWGu.js";import"./react-router-dom-BCp3cZHX.js";import"./react-router-CeklShVs.js";import"./@remix-run-CbFatO5U.js";import"./react-redux-10GvvXuy.js";import"./use-sync-external-store-De7g8zNk.js";import"./axios-Cm0UX6qg.js";import"./@reduxjs-DVdFRU_h.js";import"./redux-DITMfSWq.js";import"./immer-BWU1mfoO.js";import"./reselect-BeKUwQU7.js";import"./redux-thunk-ClJT1hhx.js";import"./react-typed-DYA10Kre.js";import"./typed.js-exEGtOgn.js";import"./react-bootstrap-sweetalert-DQB2ynYp.js";import"./prop-types-C1xvqhu3.js";import"./swiper-DTKdPQEP.js";import"./fslightbox-react-CQdsEJ3s.js";import"./react-bootstrap-C0bN-j8n.js";import"./classnames-BfIYw_zE.js";import"./@restart-JOvkJ3VN.js";import"./dom-helpers-nL1pTuZz.js";import"./react-transition-group-DSzsIoyj.js";import"./react-lazyload-DZ8paPqQ.js";import"./react-loading-skeleton-D7jF0Q-E.js";import"./@emotion-C2ZuPDAx.js";import"./hoist-non-react-statics-Buxaj0Kl.js";import"./react-is-8JwjhRSi.js";import"./stylis-NkKAe6Bn.js";import"./clsx-B-dksMZM.js";import"./@popperjs-BQBsAJpH.js";const us=()=>{const[X,z]=o.useState([]),[w,Y]=o.useState([]),[D,Z]=o.useState([]),[$,x]=o.useState(!1),[ee,q]=o.useState(!1),[I,R]=o.useState(null),[n,b]=o.useState(null),[c,se]=o.useState(""),[S,re]=o.useState({}),{enqueueSnackbar:u}=he(),[r,h]=o.useState({userId:"",seriesId:"",currency:"PKR",amount:"",couponCode:"",discountApplied:"",status:"created",provider:"manual",providerRef:""}),[m,_]=o.useState({}),te=["created","processing","paid","failed","canceled","refunded"],ie=["stripe","manual"];o.useEffect(()=>{ne(),ae(),U()},[]),o.useEffect(()=>{c?T(c):k()},[c]);const ne=async()=>{try{const s=await p.get("/series/all");Y(s.data)}catch{u("Failed to fetch series",{variant:"error"})}},ae=async()=>{try{const s=await p.get("/user/all");Z(s.data)}catch{u("Failed to fetch users",{variant:"error"})}},T=async s=>{try{x(!0);const a=await p.get(`/payments/series/${s}`);z(a.data)}catch{u("Failed to fetch payments",{variant:"error"})}finally{x(!1)}},k=async()=>{try{x(!0);const s=await p.get("/payments/all");z(s.data)}catch{u("Failed to fetch payments",{variant:"error"})}finally{x(!1)}},U=async()=>{try{const s=await p.get("/payments/stats/overview");re(s.data)}catch{u("Failed to fetch statistics",{variant:"error"})}},W=(s=null)=>{s?(R(s),h({userId:s.userId._id||s.userId,seriesId:s.seriesId._id||s.seriesId,currency:s.currency,amount:s.amount,couponCode:s.couponCode||"",discountApplied:s.discountApplied||"",status:s.status,provider:s.provider,providerRef:s.providerRef||""})):(R(null),h({userId:"",seriesId:c||"",currency:"PKR",amount:"",couponCode:"",discountApplied:"",status:"created",provider:"manual",providerRef:""})),_({}),q(!0)},E=()=>{q(!1),R(null),_({})},le=()=>{const s={};return r.userId||(s.userId="User is required"),r.seriesId||(s.seriesId="Series is required"),r.amount||(s.amount="Amount is required"),_(s),Object.keys(s).length===0},oe=async()=>{var s,a;if(le())try{x(!0);const d={...r,amount:Number(r.amount),discountApplied:r.discountApplied?Number(r.discountApplied):0};I?(await p.put(`/payments/${I._id}`,d),u("Payment updated successfully",{variant:"success"})):(await p.post("/payments",d),u("Payment created successfully",{variant:"success"})),E(),c?T(c):k(),U()}catch(d){u(((a=(s=d.response)==null?void 0:s.data)==null?void 0:a.error)||"Operation failed",{variant:"error"})}finally{x(!1)}},de=async s=>{if(window.confirm("Are you sure you want to delete this payment? This action cannot be undone."))try{x(!0),await p.delete(`/payments/${s}`),u("Payment deleted successfully",{variant:"success"}),c?T(c):k(),U()}catch{u("Failed to delete payment",{variant:"error"})}finally{x(!1)}},P=(s,a,d,ue)=>e.jsx(N,{sx:{minWidth:275,bgcolor:ue},children:e.jsx(B,{children:e.jsxs(C,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(C,{children:[e.jsx(i,{variant:"h6",component:"div",color:"white",children:s}),e.jsx(i,{variant:"h4",component:"div",color:"white",children:a})]}),e.jsx(C,{color:"white",children:d})]})})}),ce=s=>{switch(s){case"paid":return"success";case"processing":return"warning";case"failed":return"error";case"canceled":return"default";case"refunded":return"info";default:return"default"}},F=s=>{const a=D.find(d=>d._id===s);return a?a.username:"Unknown User"},O=s=>{const a=D.find(d=>d._id===s);return a?a.email:"Unknown Email"},K=s=>{const a=w.find(d=>d._id===s);return a?a.title:"Unknown Series"};return e.jsxs("div",{className:"container-fluid",children:[e.jsxs("div",{className:"d-sm-flex align-items-center justify-content-between mb-4",children:[e.jsx("h1",{className:"h3 mb-0 text-gray-800",children:"Payment Management"}),e.jsx(f,{variant:"contained",startIcon:e.jsx(xe,{}),onClick:()=>W(),sx:{bgcolor:"#4e73df"},children:"Add New Payment"})]}),e.jsxs(t,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(t,{item:!0,xs:12,sm:6,md:3,children:P("Total Payments",S.totalPayments||0,e.jsx(be,{}),"#4e73df")}),e.jsx(t,{item:!0,xs:12,sm:6,md:3,children:P("Paid Payments",S.paidPayments||0,e.jsx(Se,{}),"#1cc88a")}),e.jsx(t,{item:!0,xs:12,sm:6,md:3,children:P("Pending Payments",S.pendingPayments||0,e.jsx(Pe,{}),"#f6c23e")}),e.jsx(t,{item:!0,xs:12,sm:6,md:3,children:P("Total Revenue",`PKR ${(S.totalRevenue||0).toLocaleString()}`,e.jsx(Ae,{}),"#e74a3b")})]}),e.jsx(N,{sx:{mb:4},children:e.jsxs(B,{children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"Filter by Series"}),e.jsxs(v,{fullWidth:!0,children:[e.jsx(y,{children:"Choose Series"}),e.jsxs(g,{value:c,onChange:s=>se(s.target.value),children:[e.jsx(j,{value:"",children:"All Series"}),w.map(s=>e.jsx(j,{value:s._id,children:s.title},s._id))]})]})]})}),e.jsx(N,{children:e.jsxs(B,{children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:c?`Payments for ${K(c)}`:"All Payments"}),e.jsx(me,{component:pe,children:e.jsxs(je,{children:[e.jsx(fe,{children:e.jsxs(M,{children:[e.jsx(l,{children:"Customer"}),e.jsx(l,{children:"Series"}),e.jsx(l,{children:"Amount"}),e.jsx(l,{children:"Status"}),e.jsx(l,{children:"Provider"}),e.jsx(l,{children:"Date"}),e.jsx(l,{children:"Actions"})]})}),e.jsx(ve,{children:X.map(s=>e.jsxs(M,{children:[e.jsx(l,{children:e.jsxs(C,{display:"flex",alignItems:"center",children:[e.jsx(ye,{sx:{mr:2,width:32,height:32},children:F(s.userId._id||s.userId).charAt(0).toUpperCase()}),e.jsxs(C,{children:[e.jsx(i,{variant:"body2",children:F(s.userId._id||s.userId)}),e.jsx(i,{variant:"caption",color:"textSecondary",children:O(s.userId._id||s.userId)})]})]})}),e.jsx(l,{children:e.jsx(i,{variant:"body2",children:K(s.seriesId._id||s.seriesId)})}),e.jsxs(l,{children:[e.jsxs(i,{variant:"body2",children:["PKR ",s.amount.toLocaleString()]}),s.discountApplied>0&&e.jsxs(i,{variant:"caption",color:"textSecondary",children:["Discount: PKR ",s.discountApplied]})]}),e.jsx(l,{children:e.jsx(G,{label:s.status,color:ce(s.status),size:"small"})}),e.jsx(l,{children:e.jsx(G,{label:s.provider,size:"small",variant:"outlined"})}),e.jsx(l,{children:new Date(s.createdAt).toLocaleDateString()}),e.jsxs(l,{children:[e.jsx(L,{size:"small",onClick:()=>b(s),color:"primary",children:e.jsx(ge,{})}),e.jsx(L,{size:"small",onClick:()=>W(s),color:"primary",children:e.jsx(Ce,{})}),e.jsx(L,{size:"small",onClick:()=>de(s._id),color:"error",children:e.jsx(Ie,{})})]})]},s._id))})]})})]})}),e.jsxs(H,{open:ee,onClose:E,maxWidth:"md",fullWidth:!0,children:[e.jsx(J,{children:I?"Edit Payment":"Add New Payment"}),e.jsx(V,{children:e.jsxs(t,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsxs(v,{fullWidth:!0,error:!!m.userId,children:[e.jsx(y,{children:"User"}),e.jsx(g,{value:r.userId,onChange:s=>h({...r,userId:s.target.value}),children:D.map(s=>e.jsxs(j,{value:s._id,children:[s.username," (",s.email,")"]},s._id))}),m.userId&&e.jsx(i,{variant:"caption",color:"error",children:m.userId})]})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsxs(v,{fullWidth:!0,error:!!m.seriesId,children:[e.jsx(y,{children:"Series"}),e.jsx(g,{value:r.seriesId,onChange:s=>h({...r,seriesId:s.target.value}),children:w.map(s=>e.jsx(j,{value:s._id,children:s.title},s._id))}),m.seriesId&&e.jsx(i,{variant:"caption",color:"error",children:m.seriesId})]})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsx(A,{fullWidth:!0,label:"Amount (PKR)",type:"number",value:r.amount,onChange:s=>h({...r,amount:s.target.value}),error:!!m.amount,helperText:m.amount})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsx(A,{fullWidth:!0,label:"Discount Applied (PKR)",type:"number",value:r.discountApplied,onChange:s=>h({...r,discountApplied:s.target.value})})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsx(A,{fullWidth:!0,label:"Coupon Code",value:r.couponCode,onChange:s=>h({...r,couponCode:s.target.value})})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsxs(v,{fullWidth:!0,children:[e.jsx(y,{children:"Status"}),e.jsx(g,{value:r.status,onChange:s=>h({...r,status:s.target.value}),children:te.map(s=>e.jsx(j,{value:s,children:s.charAt(0).toUpperCase()+s.slice(1)},s))})]})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsxs(v,{fullWidth:!0,children:[e.jsx(y,{children:"Provider"}),e.jsx(g,{value:r.provider,onChange:s=>h({...r,provider:s.target.value}),children:ie.map(s=>e.jsx(j,{value:s,children:s.charAt(0).toUpperCase()+s.slice(1)},s))})]})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsx(A,{fullWidth:!0,label:"Provider Reference",value:r.providerRef,onChange:s=>h({...r,providerRef:s.target.value})})})]})}),e.jsxs(Q,{children:[e.jsx(f,{onClick:E,children:"Cancel"}),e.jsx(f,{onClick:oe,variant:"contained",disabled:$,sx:{bgcolor:"#4e73df"},children:$?"Saving...":I?"Update":"Create"})]})]}),e.jsx(H,{open:!!n,onClose:()=>b(null),maxWidth:"md",fullWidth:!0,children:n&&e.jsxs(e.Fragment,{children:[e.jsx(J,{children:"Payment Details"}),e.jsx(V,{children:e.jsxs(t,{container:!0,spacing:2,children:[e.jsxs(t,{item:!0,xs:12,children:[e.jsx(i,{variant:"h6",children:"Customer Information"}),e.jsxs(i,{variant:"body2",children:["Name: ",F(n.userId._id||n.userId)]}),e.jsxs(i,{variant:"body2",children:["Email: ",O(n.userId._id||n.userId)]})]}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(i,{variant:"h6",children:"Series Information"}),e.jsxs(i,{variant:"body2",children:["Series: ",K(n.seriesId._id||n.seriesId)]})]}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsxs(i,{variant:"subtitle2",children:["Amount: PKR ",n.amount.toLocaleString()]})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsxs(i,{variant:"subtitle2",children:["Status: ",n.status]})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsxs(i,{variant:"subtitle2",children:["Provider: ",n.provider]})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsxs(i,{variant:"subtitle2",children:["Date: ",new Date(n.createdAt).toLocaleDateString()]})}),n.couponCode&&e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsxs(i,{variant:"subtitle2",children:["Coupon: ",n.couponCode]})}),n.discountApplied>0&&e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsxs(i,{variant:"subtitle2",children:["Discount: PKR ",n.discountApplied]})})]})}),e.jsxs(Q,{children:[e.jsx(f,{onClick:()=>b(null),children:"Close"}),e.jsx(f,{onClick:()=>{b(null),W(n)},variant:"contained",sx:{bgcolor:"#4e73df"},children:"Edit"})]})]})})]})};export{us as default};
