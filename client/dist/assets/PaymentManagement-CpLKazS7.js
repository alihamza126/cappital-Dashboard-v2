import{r as o,j as e}from"./react-BLQlKNq_.js";import{u as pe}from"./notistack-DWKSkMQ9.js";import{a as p}from"./index-DbnCLypk.js";import{F as Q}from"./fslightbox-react-CQdsEJ3s.js";import{F as g,a8 as je,af as t,v as O,ag as $,b as i,G as y,H as C,J as b,f,w as fe,P as ve,x as ge,j as ye,T as X,a as l,y as Ce,B as I,A as be,aj as Y,I as q,ak as Ie,ar as Se,al as Pe,am as Z,an as ee,ao as se,R as _,ap as re,ad as Ae,aK as we,aF as Re,aJ as De}from"./@mui-Bw2wRnxu.js";import"./@babel-HOuxngs4.js";import"./react-dom-DmmE3xc2.js";import"./scheduler-CzFDRTuY.js";import"./goober-DovPBWGu.js";import"./react-router-dom-BCp3cZHX.js";import"./react-router-CeklShVs.js";import"./@remix-run-CbFatO5U.js";import"./react-redux-10GvvXuy.js";import"./use-sync-external-store-De7g8zNk.js";import"./axios-Cm0UX6qg.js";import"./@reduxjs-DVdFRU_h.js";import"./redux-DITMfSWq.js";import"./immer-BWU1mfoO.js";import"./reselect-BeKUwQU7.js";import"./redux-thunk-ClJT1hhx.js";import"./react-typed-DYA10Kre.js";import"./typed.js-exEGtOgn.js";import"./react-bootstrap-sweetalert-DQB2ynYp.js";import"./prop-types-C1xvqhu3.js";import"./swiper-DTKdPQEP.js";import"./yet-another-react-lightbox-DocsD2co.js";import"./react-bootstrap-C0bN-j8n.js";import"./classnames-BfIYw_zE.js";import"./@restart-JOvkJ3VN.js";import"./dom-helpers-nL1pTuZz.js";import"./react-transition-group-DSzsIoyj.js";import"./react-lazyload-DZ8paPqQ.js";import"./react-loading-skeleton-D7jF0Q-E.js";import"./@emotion-C2ZuPDAx.js";import"./hoist-non-react-statics-Buxaj0Kl.js";import"./react-is-8JwjhRSi.js";import"./stylis-NkKAe6Bn.js";import"./clsx-B-dksMZM.js";import"./@popperjs-BQBsAJpH.js";const ps=()=>{const[S,M]=o.useState([]),[j,te]=o.useState([]),[v,ie]=o.useState([]),[G,x]=o.useState(!1),[ne,H]=o.useState(!1),[P,k]=o.useState(null),[n,A]=o.useState(null),[c,ae]=o.useState(""),[w,oe]=o.useState({}),{enqueueSnackbar:u}=pe(),[J,R]=o.useState(!1),[r,h]=o.useState({userId:"",seriesId:"",currency:"PKR",amount:"",couponCode:"",discountApplied:"",status:"created",provider:"manual",providerRef:""}),[m,F]=o.useState({}),T=["created","processing","paid","failed","canceled","refunded"],U=["stripe","manual"];o.useEffect(()=>{le(),de(),N()},[]),o.useEffect(()=>{c?W(c):E()},[c]);const le=async()=>{try{const s=await p.get("/series/all");te(s.data)}catch{u("Failed to fetch series",{variant:"error"})}},de=async()=>{try{const s=await p.get("/user");ie(s.data||[])}catch{u("Failed to fetch users",{variant:"error"})}},W=async s=>{try{x(!0);const a=await p.get(`/payments/series/${s}`);M(a.data)}catch{u("Failed to fetch payments",{variant:"error"})}finally{x(!1)}},E=async()=>{try{x(!0);const s=await p.get("/payments/all");M(s.data)}catch{u("Failed to fetch payments",{variant:"error"})}finally{x(!1)}},N=async()=>{try{const s=await p.get("/payments/stats/overview");oe(s.data)}catch{u("Failed to fetch statistics",{variant:"error"})}},K=(s=null)=>{s?(k(s),h({userId:s.userId._id||s.userId,seriesId:s.seriesId._id||s.seriesId,currency:s.currency,amount:s.amount,couponCode:s.couponCode||"",discountApplied:s.discountApplied||"",status:s.status,provider:s.provider,providerRef:s.providerRef||""})):(k(null),h({userId:"",seriesId:c||"",currency:"PKR",amount:"",couponCode:"",discountApplied:"",status:"created",provider:"manual",providerRef:""})),F({}),H(!0)},L=()=>{H(!1),k(null),F({})},ce=()=>{const s={};return r.userId||(s.userId="User is required"),r.seriesId||(s.seriesId="Series is required"),r.amount||(s.amount="Amount is required"),F(s),Object.keys(s).length===0},ue=async()=>{var s,a;if(ce())try{x(!0);const d={...r,amount:Number(r.amount),discountApplied:r.discountApplied?Number(r.discountApplied):0};console.log("payment is",S),P?(await p.put(`/payments/${P._id}`,d),u("Payment updated successfully",{variant:"success"})):(await p.post("/payments",d),u("Payment created successfully",{variant:"success"})),L(),c?W(c):E(),N()}catch(d){u(((a=(s=d.response)==null?void 0:s.data)==null?void 0:a.error)||"Operation failed",{variant:"error"})}finally{x(!1)}},he=async s=>{if(window.confirm("Are you sure you want to delete this payment? This action cannot be undone."))try{x(!0),await p.delete(`/payments/${s}`),u("Payment deleted successfully",{variant:"success"}),c?W(c):E(),N()}catch{u("Failed to delete payment",{variant:"error"})}finally{x(!1)}},D=(s,a,d,me)=>e.jsx(O,{sx:{minWidth:275,bgcolor:me},children:e.jsx($,{children:e.jsxs(I,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(I,{children:[e.jsx(i,{variant:"h6",component:"div",color:"white",children:s}),e.jsx(i,{variant:"h4",component:"div",color:"white",children:a})]}),e.jsx(I,{color:"white",children:d})]})})}),xe=s=>{switch(s){case"paid":return"success";case"processing":return"warning";case"failed":return"error";case"canceled":return"default";case"refunded":return"info";default:return"default"}},z=s=>{const a=v.find(d=>d._id===s);return a?a.username:"Unknown User"},V=s=>{const a=v.find(d=>d._id===s);return a?a.email:"Unknown Email"},B=s=>{const a=j.find(d=>d._id===s);return a?a.title:"Unknown Series"};return e.jsxs("div",{className:"container-fluid",children:[e.jsxs("div",{className:"d-sm-flex align-items-center justify-content-between mb-4",children:[e.jsx("h1",{className:"h3 mb-0 text-gray-800",children:"Payment Management"}),e.jsx(g,{variant:"contained",startIcon:e.jsx(je,{}),onClick:()=>K(),sx:{bgcolor:"#4e73df"},children:"Add New Payment"})]}),e.jsxs(t,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(t,{item:!0,xs:12,sm:6,md:3,children:D("Total Payments",w.totalPayments||0,e.jsx(Ae,{}),"#4e73df")}),e.jsx(t,{item:!0,xs:12,sm:6,md:3,children:D("Paid Payments",w.paidPayments||0,e.jsx(we,{}),"#1cc88a")}),e.jsx(t,{item:!0,xs:12,sm:6,md:3,children:D("Pending Payments",w.pendingPayments||0,e.jsx(Re,{}),"#f6c23e")}),e.jsx(t,{item:!0,xs:12,sm:6,md:3,children:D("Total Revenue",`PKR ${(w.totalRevenue||0).toLocaleString()}`,e.jsx(De,{}),"#e74a3b")})]}),e.jsx(O,{sx:{mb:4},children:e.jsxs($,{children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:"Filter by Series"}),e.jsxs(y,{fullWidth:!0,children:[e.jsx(C,{children:"Choose Series"}),e.jsxs(b,{value:c,onChange:s=>ae(s.target.value),children:[e.jsx(f,{value:"",children:"All Series"}),j==null?void 0:j.map(s=>e.jsx(f,{value:s._id,children:s.title},s._id))]})]})]})}),e.jsx(O,{children:e.jsxs($,{children:[e.jsx(i,{variant:"h6",gutterBottom:!0,children:c?`Payments for ${B(c)}`:"All Payments"}),e.jsx(fe,{component:ve,children:e.jsxs(ge,{children:[e.jsx(ye,{children:e.jsxs(X,{children:[e.jsx(l,{children:"Customer"}),e.jsx(l,{children:"Series"}),e.jsx(l,{children:"Amount"}),e.jsx(l,{children:"Status"}),e.jsx(l,{children:"Provider"}),e.jsx(l,{children:"Date"}),e.jsx(l,{children:"Actions"})]})}),e.jsx(Ce,{children:S==null?void 0:S.map(s=>e.jsxs(X,{children:[e.jsx(l,{children:e.jsxs(I,{display:"flex",alignItems:"center",children:[e.jsx(be,{sx:{mr:2,width:32,height:32},children:z(s.userId._id||s.userId).charAt(0).toUpperCase()}),e.jsxs(I,{children:[e.jsx(i,{variant:"body2",children:z(s.userId._id||s.userId)}),e.jsx(i,{variant:"caption",color:"textSecondary",children:V(s.userId._id||s.userId)})]})]})}),e.jsx(l,{children:e.jsx(i,{variant:"body2",children:B(s.seriesId._id||s.seriesId)})}),e.jsxs(l,{children:[e.jsxs(i,{variant:"body2",children:["PKR ",s.amount.toLocaleString()]}),s.discountApplied>0&&e.jsxs(i,{variant:"caption",color:"textSecondary",children:["Discount: PKR ",s.discountApplied]})]}),e.jsx(l,{children:e.jsx(Y,{label:s.status,color:xe(s.status),size:"small"})}),e.jsx(l,{children:e.jsx(Y,{label:s.provider,size:"small",variant:"outlined"})}),e.jsx(l,{children:new Date(s.createdAt).toLocaleDateString()}),e.jsxs(l,{children:[e.jsx(q,{size:"small",onClick:()=>A(s),color:"primary",children:e.jsx(Ie,{})}),e.jsx(q,{size:"small",onClick:()=>K(s),color:"primary",children:e.jsx(Se,{})}),e.jsx(q,{size:"small",onClick:()=>he(s._id),color:"error",children:e.jsx(Pe,{})})]})]},s._id))})]})})]})}),e.jsxs(Z,{open:ne,onClose:L,maxWidth:"md",fullWidth:!0,children:[e.jsx(ee,{children:P?"Edit Payment":"Add New Payment"}),e.jsx(se,{children:e.jsxs(t,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsxs(y,{fullWidth:!0,error:!!m.userId,children:[e.jsx(C,{children:"User"}),e.jsx(b,{value:r.userId,onChange:s=>h({...r,userId:s.target.value}),children:v==null?void 0:v.map(s=>e.jsxs(f,{value:s._id,children:[s.username," (",s.email,")"]},s._id))}),m.userId&&e.jsx(i,{variant:"caption",color:"error",children:m.userId})]})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsxs(y,{fullWidth:!0,error:!!m.seriesId,children:[e.jsx(C,{children:"Series"}),e.jsx(b,{value:r.seriesId,onChange:s=>h({...r,seriesId:s.target.value}),children:j==null?void 0:j.map(s=>e.jsx(f,{value:s._id,children:s.title},s._id))}),m.seriesId&&e.jsx(i,{variant:"caption",color:"error",children:m.seriesId})]})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsx(_,{fullWidth:!0,label:"Amount (PKR)",type:"number",value:r.amount,onChange:s=>h({...r,amount:s.target.value}),error:!!m.amount,helperText:m.amount})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsx(_,{fullWidth:!0,label:"Discount Applied (PKR)",type:"number",value:r.discountApplied,onChange:s=>h({...r,discountApplied:s.target.value})})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsx(_,{fullWidth:!0,label:"Coupon Code",value:r.couponCode,onChange:s=>h({...r,couponCode:s.target.value})})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsxs(y,{fullWidth:!0,children:[e.jsx(C,{children:"Status"}),e.jsx(b,{value:r.status,onChange:s=>h({...r,status:s.target.value}),children:T==null?void 0:T.map(s=>e.jsx(f,{value:s,children:s.charAt(0).toUpperCase()+s.slice(1)},s))})]})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsxs(y,{fullWidth:!0,children:[e.jsx(C,{children:"Provider"}),e.jsx(b,{value:r.provider,onChange:s=>h({...r,provider:s.target.value}),children:U==null?void 0:U.map(s=>e.jsx(f,{value:s,children:s.charAt(0).toUpperCase()+s.slice(1)},s))})]})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsx(_,{fullWidth:!0,label:"Provider Reference",value:r.providerRef,onChange:s=>h({...r,providerRef:s.target.value})})}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx("img",{src:r.providerRef,height:90,className:"rounded-3",alt:"Payment icon",style:{cursor:"pointer"},onClick:()=>R(!0)}),e.jsx(Q,{toggler:J,sources:[r.providerRef],onClose:()=>R(!1),sourcesAction:"zoom"})]})]})}),e.jsxs(re,{children:[e.jsx(g,{onClick:L,children:"Cancel"}),e.jsx(g,{onClick:ue,variant:"contained",disabled:G,sx:{bgcolor:"#4e73df"},children:G?"Saving...":P?"Update":"Create"})]})]}),e.jsx(Z,{open:!!n,onClose:()=>A(null),maxWidth:"md",fullWidth:!0,children:n&&e.jsxs(e.Fragment,{children:[e.jsx(ee,{children:"Payment Details"}),e.jsx(se,{children:e.jsxs(t,{container:!0,spacing:2,children:[e.jsxs(t,{item:!0,xs:12,children:[e.jsx(i,{variant:"h6",children:"Customer Information"}),e.jsxs(i,{variant:"body2",children:["Name: ",z(n.userId._id||n.userId)]}),e.jsxs(i,{variant:"body2",children:["Email: ",V(n.userId._id||n.userId)]})]}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx("img",{src:n.providerRef,height:90,className:"rounded-3",alt:"Payment icon",style:{cursor:"pointer"},onClick:()=>R(!0)}),e.jsx(Q,{toggler:J,sources:[n.providerRef],onClose:()=>R(!1),sourcesAction:"zoom"}),console.log("selectedPayment.providerRef is",n.providerRef)]}),e.jsxs(t,{item:!0,xs:12,children:[e.jsx(i,{variant:"h6",children:"Series Informations"}),e.jsxs(i,{variant:"body2",children:["Series: ",B(n.seriesId._id||n.seriesId)]})]}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsxs(i,{variant:"subtitle2",children:["Amount: PKR ",n.amount.toLocaleString()]})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsxs(i,{variant:"subtitle2",children:["Status: ",n.status]})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsxs(i,{variant:"subtitle2",children:["Provider: ",n.provider]})}),e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsxs(i,{variant:"subtitle2",children:["Date: ",new Date(n.createdAt).toLocaleDateString()]})}),n.couponCode&&e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsxs(i,{variant:"subtitle2",children:["Coupon: ",n.couponCode]})}),n.discountApplied>0&&e.jsx(t,{item:!0,xs:12,sm:6,children:e.jsxs(i,{variant:"subtitle2",children:["Discount: PKR ",n.discountApplied]})})]})}),e.jsxs(re,{children:[e.jsx(g,{onClick:()=>A(null),children:"Close"}),e.jsx(g,{onClick:()=>{A(null),K(n)},variant:"contained",sx:{bgcolor:"#4e73df"},children:"Edit"})]})]})})]})};export{ps as default};
