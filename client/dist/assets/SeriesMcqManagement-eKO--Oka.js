import{r,j as e}from"./react-BLQlKNq_.js";import{u as Ee}from"./notistack-DWKSkMQ9.js";import{a as y}from"./index-DLcQWfxo.js";import{L as Ae}from"./yet-another-react-lightbox-DocsD2co.js";import{B as S,b as p,v as q,am as J,al as l,G as j,H as m,J as g,f as a,R as h,m as Fe,n as Pe,F as w,aE as Re,a8 as De,w as _e,P as ke,x as Be,j as Ne,T as R,a as n,y as $e,an as D,I as ue,ao as He,ap as ze,z as Ve,af as Ge,ag as qe,ah as Je,av as Ke,aw as K,aq as he,ai as Xe}from"./@mui-DAjQFfGe.js";import"./@babel-HOuxngs4.js";import"./react-dom-DmmE3xc2.js";import"./scheduler-CzFDRTuY.js";import"./goober-DovPBWGu.js";import"./react-router-dom-BCp3cZHX.js";import"./react-router-CeklShVs.js";import"./@remix-run-CbFatO5U.js";import"./react-redux-10GvvXuy.js";import"./use-sync-external-store-De7g8zNk.js";import"./axios-Cm0UX6qg.js";import"./@reduxjs-DVdFRU_h.js";import"./redux-DITMfSWq.js";import"./immer-BWU1mfoO.js";import"./reselect-BeKUwQU7.js";import"./redux-thunk-ClJT1hhx.js";import"./react-typed-DYA10Kre.js";import"./typed.js-exEGtOgn.js";import"./react-bootstrap-sweetalert-DQB2ynYp.js";import"./prop-types-C1xvqhu3.js";import"./swiper-DTKdPQEP.js";import"./fslightbox-react-CQdsEJ3s.js";import"./react-bootstrap-C0bN-j8n.js";import"./classnames-BfIYw_zE.js";import"./@restart-JOvkJ3VN.js";import"./dom-helpers-nL1pTuZz.js";import"./react-transition-group-DSzsIoyj.js";import"./react-lazyload-DZ8paPqQ.js";import"./react-loading-skeleton-D7jF0Q-E.js";import"./@emotion-C2ZuPDAx.js";import"./hoist-non-react-statics-Buxaj0Kl.js";import"./react-is-8JwjhRSi.js";import"./stylis-NkKAe6Bn.js";import"./clsx-B-dksMZM.js";import"./@popperjs-BQBsAJpH.js";const Rt=()=>{var ce,de;const[M,T]=r.useState([]),[X,U]=r.useState([]),[Y,L]=r.useState(!1),[xe,Z]=r.useState(!1),[W,_]=r.useState(null),[f,pe]=r.useState([]),[b,ee]=r.useState([]),[d,je]=r.useState(""),[C,k]=r.useState(""),[B,te]=r.useState(0),[se,me]=r.useState(10),[ge,Q]=r.useState(0),[o,O]=r.useState({subject:[],chapter:"",topic:"",difficulty:""}),[I,ie]=r.useState(""),[E,ae]=r.useState(0),[N,re]=r.useState(null),[$,A]=r.useState(""),[H,le]=r.useState(null),[z,F]=r.useState(""),[fe,ne]=r.useState(!1),[ve,be]=r.useState([]),{enqueueSnackbar:x}=Ee(),[i,c]=r.useState({question:"",options:["","","",""],correctOption:0,subject:[],chapter:"",topic:"",difficulty:"easy",category:"normal",course:"mdcat",info:"",explain:"",imageUrl:"",questionImg:"",seriesId:"",testId:""});r.useEffect(()=>{Ce()},[]),r.useEffect(()=>{d?V():(T([]),U([]),Q(0))},[d,B,se]),r.useEffect(()=>{d?ye(d):(ee([]),k(""))},[d]),r.useEffect(()=>{Ie()},[o,I,X,C]);const Ce=async()=>{try{const t=await y.get("/series/all");console.log(t.data),pe(t.data||[])}catch(t){console.error("Error fetching series:",t),x("Failed to fetch series",{variant:"error"})}},ye=async t=>{try{const s=await y.get(`/tests/series/${t}`);ee(s.data||[])}catch(s){console.error("Error fetching tests:",s),x("Failed to fetch tests",{variant:"error"})}},V=async()=>{if(!d){T([]),U([]),Q(0);return}L(!0);try{const t=new URLSearchParams({page:B+1,limit:1e3,...o}),s=await y.get(`/series-mcqs/series/${d}?${t}`);T(s.data.mcqs||[]),U(s.data.mcqs||[]),Q(s.data.total||0)}catch(t){console.error("Error fetching MCQs:",t),x("Failed to fetch MCQs",{variant:"error"}),T([]),U([]),Q(0)}finally{L(!1)}},Ie=()=>{let t=[...X];C&&(t=t.filter(s=>{var u;return((u=s.testId)==null?void 0:u._id)===C})),I&&(t=t.filter(s=>s.question.toLowerCase().includes(I.toLowerCase())||s.chapter.toLowerCase().includes(I.toLowerCase())||s.topic.toLowerCase().includes(I.toLowerCase()))),o.subject&&o.subject.length>0&&(t=t.filter(s=>{const u=Array.isArray(s.subject)?s.subject:[s.subject];return o.subject.some(v=>u.includes(v))})),o.chapter&&(t=t.filter(s=>s.chapter.toLowerCase().includes(o.chapter.toLowerCase()))),o.topic&&(t=t.filter(s=>s.topic.toLowerCase().includes(o.topic.toLowerCase()))),o.difficulty&&(t=t.filter(s=>s.difficulty===o.difficulty)),T(t),Q(t.length)},oe=(t=null)=>{t?(_(t),c({question:t.question,options:t.options,correctOption:t.correctOption,subject:Array.isArray(t.subject)?t.subject:[t.subject],chapter:t.chapter,topic:t.topic,difficulty:t.difficulty,category:t.category,course:t.course,info:t.info||"",explain:t.explain||"",imageUrl:t.imageUrl||"",questionImg:t.questionImg||"",seriesId:t.seriesId,testId:t.testId||""}),A(t.imageUrl||""),F(t.questionImg||"")):(_(null),c({question:"",options:["","","",""],correctOption:0,subject:[],chapter:"",topic:"",difficulty:"easy",category:"normal",course:"mdcat",info:"",explain:"",imageUrl:"",questionImg:"",seriesId:d,testId:C}),A(""),F("")),ae(0),Z(!0)},G=()=>{Z(!1),_(null),re(null),A(""),le(null),F(""),c({question:"",options:["","","",""],correctOption:0,subject:[],chapter:"",topic:"",difficulty:"easy",category:"normal",course:"mdcat",info:"",explain:"",imageUrl:"",questionImg:"",seriesId:"",testId:""})},Se=t=>{const s=t.target.files[0];s&&(re(s),A(URL.createObjectURL(s)))},we=t=>{const s=t.target.files[0];s&&(le(s),F(URL.createObjectURL(s)))},Me=(t,s)=>{ae(s)},P=(t,s=0)=>{be(t),ne(!0)},Te=async()=>{try{L(!0);let t={...i};if(N){const s=new FormData;s.append("image",N);const u={headers:{"Content-Type":"multipart/form-data"}},v=await y.post("/upload/img",s,u);if(v.status===200)t.imageUrl=v.data.fileURL;else{x("Failed to upload MCQ image",{variant:"error"});return}}if(H){const s=new FormData;s.append("image",H);const u={headers:{"Content-Type":"multipart/form-data"}},v=await y.post("/upload/img",s,u);if(v.status===200)t.questionImg=v.data.fileURL;else{x("Failed to upload question image",{variant:"error"});return}}W?(await y.put(`/series-mcqs/${W._id}`,t),x("MCQ updated successfully",{variant:"success"})):(await y.post("/series-mcqs",t),x("MCQ created successfully",{variant:"success"})),G(),V()}catch(t){console.error("Error saving MCQ:",t),x("Failed to save MCQ",{variant:"error"})}finally{L(!1)}},Qe=async t=>{if(window.confirm("Are you sure you want to delete this MCQ?"))try{await y.delete(`/series-mcqs/${t}`),x("MCQ deleted successfully",{variant:"success"}),V()}catch(s){console.error("Error deleting MCQ:",s),x("Failed to delete MCQ",{variant:"error"})}},Oe=(t,s)=>{const u=[...i.options];u[t]=s,c({...i,options:u})},Ue=()=>{O({subject:[],chapter:"",topic:"",difficulty:""}),ie(""),k("")},Le=(t,s)=>{te(s)},We=t=>{me(Number.parseInt(t.target.value,10)),te(0)};return e.jsxs(S,{sx:{p:3},children:[e.jsx(p,{variant:"h4",gutterBottom:!0,children:"Series MCQ Management"}),e.jsx(q,{sx:{mb:3},children:e.jsx(J,{children:e.jsxs(l,{container:!0,spacing:2,children:[e.jsx(l,{item:!0,xs:12,md:6,children:e.jsxs(j,{fullWidth:!0,children:[e.jsx(m,{children:"Select Series"}),e.jsx(g,{value:d,onChange:t=>je(t.target.value),label:"Select Series",children:f&&(f==null?void 0:f.map(t=>e.jsx(a,{value:t._id,children:t.title},t._id)))})]})}),e.jsx(l,{item:!0,xs:12,md:6,children:e.jsxs(j,{fullWidth:!0,children:[e.jsx(m,{children:"Filter by Test (Optional)"}),e.jsxs(g,{value:C,onChange:t=>k(t.target.value),label:"Filter by Test (Optional)",children:[e.jsx(a,{value:"",children:"All Tests"}),b==null?void 0:b.map(t=>e.jsx(a,{value:t._id,children:t.title},t._id))]})]})})]})})}),e.jsx(q,{sx:{mb:3},children:e.jsx(J,{children:e.jsxs(l,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(l,{item:!0,xs:12,md:3,children:e.jsx(h,{fullWidth:!0,placeholder:"Search questions...",value:I,onChange:t=>ie(t.target.value),InputProps:{startAdornment:e.jsx(Fe,{position:"start",children:e.jsx(Pe,{})})}})}),e.jsx(l,{item:!0,xs:12,md:2,children:e.jsxs(j,{fullWidth:!0,children:[e.jsx(m,{children:"Subject"}),e.jsxs(g,{multiple:!0,value:o.subject,onChange:t=>O({...o,subject:t.target.value}),label:"Subject",renderValue:t=>t.join(", "),children:[e.jsx(a,{value:"physics",children:"Physics"}),e.jsx(a,{value:"chemistry",children:"Chemistry"}),e.jsx(a,{value:"biology",children:"Biology"}),e.jsx(a,{value:"english",children:"English"}),e.jsx(a,{value:"mathematics",children:"Mathematics"}),e.jsx(a,{value:"logic",children:"Logic"}),e.jsx(a,{value:"others",children:"Others"})]})]})}),e.jsx(l,{item:!0,xs:12,md:2,children:e.jsx(h,{fullWidth:!0,placeholder:"Chapter",value:o.chapter,onChange:t=>O({...o,chapter:t.target.value})})}),e.jsx(l,{item:!0,xs:12,md:2,children:e.jsx(h,{fullWidth:!0,placeholder:"Topic",value:o.topic,onChange:t=>O({...o,topic:t.target.value})})}),e.jsx(l,{item:!0,xs:12,md:2,children:e.jsxs(j,{fullWidth:!0,children:[e.jsx(m,{children:"Difficulty"}),e.jsxs(g,{value:o.difficulty,onChange:t=>O({...o,difficulty:t.target.value}),label:"Difficulty",children:[e.jsx(a,{value:"",children:"All"}),e.jsx(a,{value:"easy",children:"Easy"}),e.jsx(a,{value:"medium",children:"Medium"}),e.jsx(a,{value:"hard",children:"Hard"})]})]})}),e.jsx(l,{item:!0,xs:12,md:1,children:e.jsx(w,{variant:"outlined",onClick:Ue,startIcon:e.jsx(Re,{}),children:"Clear"})})]})})}),e.jsxs(S,{sx:{mb:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(p,{variant:"h6",children:["MCQs: ",M.length," ",d&&f.find(t=>t._id===d)&&`(${f.find(t=>t._id===d).title})`,C&&b.find(t=>t._id===C)&&` - Test: ${b.find(t=>t._id===C).title}`]}),e.jsx(w,{variant:"contained",startIcon:e.jsx(De,{}),onClick:()=>oe(),disabled:!d,children:"Add MCQ"})]}),d?e.jsxs(_e,{component:ke,children:[e.jsxs(Be,{children:[e.jsx(Ne,{children:e.jsxs(R,{children:[e.jsx(n,{children:"Question"}),e.jsx(n,{children:"Subject"}),e.jsx(n,{children:"Chapter"}),e.jsx(n,{children:"Topic"}),e.jsx(n,{children:"Difficulty"}),e.jsx(n,{children:"Test"}),e.jsx(n,{children:"Explanation Image"}),e.jsx(n,{children:"Question Image"}),e.jsx(n,{children:"Actions"})]})}),e.jsx($e,{children:Y?e.jsx(R,{children:e.jsx(n,{colSpan:9,sx:{textAlign:"center",py:4},children:e.jsx(p,{children:"Loading MCQs..."})})}):M.length===0?e.jsx(R,{children:e.jsx(n,{colSpan:9,sx:{textAlign:"center",py:4},children:e.jsx(p,{color:"text.secondary",children:"No MCQs found for this series"})})}):M==null?void 0:M.map(t=>{var s;return e.jsxs(R,{children:[e.jsx(n,{children:e.jsx(p,{variant:"body2",noWrap:!0,sx:{maxWidth:200},children:t.question})}),e.jsx(n,{children:Array.isArray(t.subject)?t.subject.map((u,v)=>e.jsx(D,{label:u.charAt(0).toUpperCase()+u.slice(1),size:"small",sx:{mr:.5,mb:.5}},v)):e.jsx(D,{label:t.subject.charAt(0).toUpperCase()+t.subject.slice(1),size:"small"})}),e.jsx(n,{children:t.chapter}),e.jsx(n,{children:t.topic}),e.jsx(n,{children:e.jsx(D,{label:t.difficulty,size:"small",color:t.difficulty==="easy"?"success":t.difficulty==="medium"?"warning":"error"})}),e.jsx(n,{children:((s=t.testId)==null?void 0:s.title)||"Not assigned"}),e.jsx(n,{children:t.imageUrl?e.jsx("img",{src:t.imageUrl,alt:"MCQ",style:{width:50,height:50,objectFit:"cover",borderRadius:4,cursor:"pointer"},onClick:()=>P([{src:t.imageUrl}],0)}):e.jsx(p,{variant:"caption",color:"text.secondary",children:"No image"})}),e.jsx(n,{children:t.questionImg?e.jsx("img",{src:t.questionImg,alt:"Question",style:{width:50,height:50,objectFit:"cover",borderRadius:4,cursor:"pointer"},onClick:()=>P([{src:t.questionImg}],0)}):e.jsx(p,{variant:"caption",color:"text.secondary",children:"No image"})}),e.jsxs(n,{children:[e.jsx(ue,{onClick:()=>oe(t),children:e.jsx(He,{})}),e.jsx(ue,{onClick:()=>Qe(t._id),color:"error",children:e.jsx(ze,{})})]})]},t._id)})})]}),e.jsx(Ve,{rowsPerPageOptions:[5,10,25],component:"div",count:ge,rowsPerPage:se,page:B,onPageChange:Le,onRowsPerPageChange:We})]}):e.jsx(q,{children:e.jsx(J,{sx:{textAlign:"center",py:4},children:e.jsx(p,{variant:"h6",color:"text.secondary",children:"Please select a series to view MCQs"})})}),e.jsxs(Ge,{open:xe,onClose:G,maxWidth:"md",fullWidth:!0,children:[e.jsx(qe,{children:W?"Edit MCQ":"Add New MCQ"}),e.jsxs(Je,{children:[e.jsxs(Ke,{value:E,onChange:Me,sx:{mb:2},children:[e.jsx(K,{label:"MCQ Details"}),e.jsx(K,{label:"Explanation Image"}),e.jsx(K,{label:"Question Image"})]}),E===0&&e.jsxs(l,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(l,{item:!0,xs:12,children:e.jsx(h,{fullWidth:!0,label:"Question",multiline:!0,rows:3,value:i.question,onChange:t=>c({...i,question:t.target.value})})}),(ce=i==null?void 0:i.options)==null?void 0:ce.map((t,s)=>e.jsx(l,{item:!0,xs:12,md:6,children:e.jsx(h,{fullWidth:!0,label:`Option ${s+1}`,value:t,onChange:u=>Oe(s,u.target.value),InputProps:{endAdornment:e.jsx(D,{label:i.correctOption===s?"Correct":"",color:i.correctOption===s?"success":"default",size:"small"})}})},s)),e.jsx(l,{item:!0,xs:12,md:6,children:e.jsxs(j,{fullWidth:!0,children:[e.jsx(m,{children:"Correct Option"}),e.jsx(g,{value:i.correctOption,onChange:t=>c({...i,correctOption:t.target.value}),label:"Correct Option",children:(de=i==null?void 0:i.options)==null?void 0:de.map((t,s)=>e.jsxs(a,{value:s,children:["Option ",s+1]},s))})]})}),e.jsx(l,{item:!0,xs:12,md:6,children:e.jsxs(j,{fullWidth:!0,children:[e.jsx(m,{children:"Subject"}),e.jsxs(g,{multiple:!0,value:i.subject,onChange:t=>c({...i,subject:t.target.value}),label:"Subject",renderValue:t=>t.join(", "),children:[e.jsx(a,{value:"physics",children:"Physics"}),e.jsx(a,{value:"chemistry",children:"Chemistry"}),e.jsx(a,{value:"biology",children:"Biology"}),e.jsx(a,{value:"english",children:"English"}),e.jsx(a,{value:"mathematics",children:"Mathematics"}),e.jsx(a,{value:"logic",children:"Logic"}),e.jsx(a,{value:"others",children:"Others"})]})]})}),e.jsx(l,{item:!0,xs:12,md:6,children:e.jsx(h,{fullWidth:!0,label:"Chapter",value:i.chapter,onChange:t=>c({...i,chapter:t.target.value})})}),e.jsx(l,{item:!0,xs:12,md:6,children:e.jsx(h,{fullWidth:!0,label:"Topic",value:i.topic,onChange:t=>c({...i,topic:t.target.value})})}),e.jsx(l,{item:!0,xs:12,md:4,children:e.jsxs(j,{fullWidth:!0,children:[e.jsx(m,{children:"Difficulty"}),e.jsxs(g,{value:i.difficulty,onChange:t=>c({...i,difficulty:t.target.value}),label:"Difficulty",children:[e.jsx(a,{value:"easy",children:"Easy"}),e.jsx(a,{value:"medium",children:"Medium"}),e.jsx(a,{value:"hard",children:"Hard"})]})]})}),e.jsx(l,{item:!0,xs:12,md:4,children:e.jsxs(j,{fullWidth:!0,children:[e.jsx(m,{children:"Category"}),e.jsxs(g,{value:i.category,onChange:t=>c({...i,category:t.target.value}),label:"Category",children:[e.jsx(a,{value:"normal",children:"Normal"}),e.jsx(a,{value:"critical",children:"Critical"})]})]})}),e.jsx(l,{item:!0,xs:12,md:4,children:e.jsxs(j,{fullWidth:!0,children:[e.jsx(m,{children:"Series"}),e.jsx(g,{value:i.seriesId,onChange:t=>c({...i,seriesId:t.target.value}),label:"Series",disabled:!!d,children:f==null?void 0:f.map(t=>e.jsx(a,{value:t._id,children:t.title},t._id))})]})}),e.jsx(l,{item:!0,xs:12,md:6,children:e.jsxs(j,{fullWidth:!0,children:[e.jsx(m,{children:"Test (Optional)"}),e.jsxs(g,{value:i.testId,onChange:t=>c({...i,testId:t.target.value}),label:"Test (Optional)",disabled:!d,children:[e.jsx(a,{value:"",children:"No Test"}),b==null?void 0:b.map(t=>e.jsx(a,{value:t._id,children:t.title},t._id))]})]})}),e.jsx(l,{item:!0,xs:12,md:6,children:e.jsx(h,{fullWidth:!0,label:"Explanation Image URL (Optional)",value:i.imageUrl,onChange:t=>c({...i,imageUrl:t.target.value}),disabled:!!N})}),e.jsx(l,{item:!0,xs:12,md:6,children:e.jsx(h,{fullWidth:!0,label:"Question Image URL (Optional)",value:i.questionImg,onChange:t=>c({...i,questionImg:t.target.value}),disabled:!!H})}),e.jsx(l,{item:!0,xs:12,children:e.jsx(h,{fullWidth:!0,label:"Info (Optional)",multiline:!0,rows:2,value:i.info,onChange:t=>c({...i,info:t.target.value})})}),e.jsx(l,{item:!0,xs:12,children:e.jsx(h,{fullWidth:!0,label:"Explanation (Optional)",multiline:!0,rows:3,value:i.explain,onChange:t=>c({...i,explain:t.target.value})})})]}),E===1&&e.jsxs(S,{children:[e.jsx(p,{variant:"h6",gutterBottom:!0,children:"Explanation Image"}),e.jsx("input",{accept:"image/*",style:{display:"none"},id:"mcq-image-upload",type:"file",onChange:Se}),e.jsx("label",{htmlFor:"mcq-image-upload",children:e.jsx(w,{variant:"outlined",component:"span",startIcon:e.jsx(he,{}),sx:{mb:2},children:"Upload Explanation Image"})}),$&&e.jsx(S,{sx:{mt:2},children:e.jsx("img",{src:$,alt:"MCQ",style:{maxWidth:"100%",maxHeight:200,borderRadius:8,cursor:"pointer"},onClick:()=>P([{src:$}],0)})})]}),E===2&&e.jsxs(S,{children:[e.jsx(p,{variant:"h6",gutterBottom:!0,children:"Question Image"}),e.jsx("input",{accept:"image/*",style:{display:"none"},id:"question-image-upload",type:"file",onChange:we}),e.jsx("label",{htmlFor:"question-image-upload",children:e.jsx(w,{variant:"outlined",component:"span",startIcon:e.jsx(he,{}),sx:{mb:2},children:"Upload Question Image"})}),z&&e.jsx(S,{sx:{mt:2},children:e.jsx("img",{src:z,alt:"Question",style:{maxWidth:"100%",maxHeight:200,borderRadius:8,cursor:"pointer"},onClick:()=>P([{src:z}],0)})})]})]}),e.jsxs(Xe,{children:[e.jsx(w,{onClick:G,children:"Cancel"}),e.jsx(w,{onClick:Te,variant:"contained",disabled:Y,children:W?"Update":"Create"})]})]}),e.jsx(Ae,{open:fe,close:()=>ne(!1),slides:ve})]})};export{Rt as default};
