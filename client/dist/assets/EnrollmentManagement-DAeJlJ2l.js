import{r as d,j as e}from"./react-BLQlKNq_.js";import{u as he}from"./notistack-DWKSkMQ9.js";import{a as p}from"./index-BZIQzIKv.js";import{F as v,a8 as ue,al as a,v as U,am as L,b as s,G as N,H as W,J as P,f as I,w as me,P as pe,x as je,j as ve,T as K,a as o,y as fe,B as h,A as ge,a0 as Ae,an as Ie,I as B,aj as ye,ao as Se,ap as Ee,af as Q,ag as X,ah as Y,R as Z,ai as ee,av as be,as as we,au as Ce,aw as De}from"./@mui-JR0bzeok.js";import"./@babel-HOuxngs4.js";import"./react-dom-DmmE3xc2.js";import"./scheduler-CzFDRTuY.js";import"./goober-DovPBWGu.js";import"./react-router-dom-BCp3cZHX.js";import"./react-router-CeklShVs.js";import"./@remix-run-CbFatO5U.js";import"./react-redux-10GvvXuy.js";import"./use-sync-external-store-De7g8zNk.js";import"./axios-Cm0UX6qg.js";import"./@reduxjs-DVdFRU_h.js";import"./redux-DITMfSWq.js";import"./immer-BWU1mfoO.js";import"./reselect-BeKUwQU7.js";import"./redux-thunk-ClJT1hhx.js";import"./react-typed-DYA10Kre.js";import"./typed.js-exEGtOgn.js";import"./react-bootstrap-sweetalert-DQB2ynYp.js";import"./prop-types-C1xvqhu3.js";import"./swiper-DTKdPQEP.js";import"./fslightbox-react-CQdsEJ3s.js";import"./react-bootstrap-C0bN-j8n.js";import"./classnames-BfIYw_zE.js";import"./@restart-JOvkJ3VN.js";import"./dom-helpers-nL1pTuZz.js";import"./react-transition-group-DSzsIoyj.js";import"./react-lazyload-DZ8paPqQ.js";import"./react-loading-skeleton-D7jF0Q-E.js";import"./@emotion-C2ZuPDAx.js";import"./hoist-non-react-statics-Buxaj0Kl.js";import"./react-is-8JwjhRSi.js";import"./stylis-NkKAe6Bn.js";import"./clsx-B-dksMZM.js";import"./@popperjs-BQBsAJpH.js";const ut=()=>{var H,J,V;const[q,z]=d.useState([]),[y,te]=d.useState([]),[S,se]=d.useState([]),[R,u]=d.useState(!1),[re,$]=d.useState(!1),[f,E]=d.useState(null),[i,g]=d.useState(null),[c,ie]=d.useState(""),[b,ae]=d.useState({}),{enqueueSnackbar:x}=he(),[n,j]=d.useState({userId:"",seriesId:"",activatedAt:"",expiresAt:"",sourceOrderId:""}),[m,w]=d.useState({});d.useEffect(()=>{ne(),le(),_()},[]),d.useEffect(()=>{c?C(c):D()},[c]);const ne=async()=>{try{const t=await p.get("/series/all");te(t.data)}catch{x("Failed to fetch series",{variant:"error"})}},le=async()=>{try{const t=await p.get("/user/all");se(t.data)}catch{x("Failed to fetch users",{variant:"error"})}},C=async t=>{try{u(!0);const r=await p.get(`/enrollments/series/${t}`);z(r.data)}catch{x("Failed to fetch enrollments",{variant:"error"})}finally{u(!1)}},D=async()=>{try{u(!0);const t=await p.get("/enrollments/all");z(t.data)}catch{x("Failed to fetch enrollments",{variant:"error"})}finally{u(!1)}},_=async()=>{try{const t=await p.get("/enrollments/stats/overview");ae(t.data)}catch{x("Failed to fetch statistics",{variant:"error"})}},T=(t=null)=>{t?(E(t),j({userId:t.userId._id||t.userId,seriesId:t.seriesId._id||t.seriesId,activatedAt:t.activatedAt?new Date(t.activatedAt).toISOString().split("T")[0]:"",expiresAt:t.expiresAt?new Date(t.expiresAt).toISOString().split("T")[0]:"",sourceOrderId:t.sourceOrderId._id||t.sourceOrderId})):(E(null),j({userId:"",seriesId:c||"",activatedAt:new Date().toISOString().split("T")[0],expiresAt:"",sourceOrderId:""})),w({}),$(!0)},k=()=>{$(!1),E(null),w({})},oe=()=>{const t={};return n.userId||(t.userId="User is required"),n.seriesId||(t.seriesId="Series is required"),n.activatedAt||(t.activatedAt="Activation date is required"),w(t),Object.keys(t).length===0},de=async()=>{var t,r;if(oe())try{u(!0);const l={...n,activatedAt:new Date(n.activatedAt),expiresAt:n.expiresAt?new Date(n.expiresAt):void 0};f?(await p.put(`/enrollments/${f._id}`,l),x("Enrollment updated successfully",{variant:"success"})):(await p.post("/enrollments",l),x("Enrollment created successfully",{variant:"success"})),k(),c?C(c):D(),_()}catch(l){x(((r=(t=l.response)==null?void 0:t.data)==null?void 0:r.error)||"Operation failed",{variant:"error"})}finally{u(!1)}},ce=async t=>{if(window.confirm("Are you sure you want to delete this enrollment? This action cannot be undone."))try{u(!0),await p.delete(`/enrollments/${t}`),x("Enrollment deleted successfully",{variant:"success"}),c?C(c):D(),_()}catch{x("Failed to delete enrollment",{variant:"error"})}finally{u(!1)}},A=(t,r,l,xe)=>e.jsx(U,{sx:{minWidth:275,bgcolor:xe},children:e.jsx(L,{children:e.jsxs(h,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(h,{children:[e.jsx(s,{variant:"h6",component:"div",color:"white",children:t}),e.jsx(s,{variant:"h4",component:"div",color:"white",children:r})]}),e.jsx(h,{color:"white",children:l})]})})}),M=t=>t.expiresAt?new Date(t.expiresAt)<new Date:!1,F=t=>{const r=S.find(l=>l._id===t);return r?r.username:"Unknown User"},G=t=>{const r=S.find(l=>l._id===t);return r?r.email:"Unknown Email"},O=t=>{const r=y.find(l=>l._id===t);return r?r.title:"Unknown Series"};return e.jsxs("div",{className:"container-fluid",children:[e.jsxs("div",{className:"d-sm-flex align-items-center justify-content-between mb-4",children:[e.jsx("h1",{className:"h3 mb-0 text-gray-800",children:"Enrollment Management"}),e.jsx(v,{variant:"contained",startIcon:e.jsx(ue,{}),onClick:()=>T(),sx:{bgcolor:"#4e73df"},children:"Add New Enrollment"})]}),e.jsxs(a,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(a,{item:!0,xs:12,sm:6,md:3,children:A("Total Enrollments",b.totalEnrollments||0,e.jsx(be,{}),"#4e73df")}),e.jsx(a,{item:!0,xs:12,sm:6,md:3,children:A("Active Enrollments",b.activeEnrollments||0,e.jsx(we,{}),"#1cc88a")}),e.jsx(a,{item:!0,xs:12,sm:6,md:3,children:A("Expired Enrollments",b.expiredEnrollments||0,e.jsx(Ce,{}),"#f6c23e")}),e.jsx(a,{item:!0,xs:12,sm:6,md:3,children:A("Current Enrollments",q.length,e.jsx(De,{}),"#e74a3b")})]}),e.jsx(U,{sx:{mb:4},children:e.jsxs(L,{children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Filter by Series"}),e.jsxs(N,{fullWidth:!0,children:[e.jsx(W,{children:"Choose Series"}),e.jsxs(P,{value:c,onChange:t=>ie(t.target.value),children:[e.jsx(I,{value:"",children:"All Series"}),y.map(t=>e.jsx(I,{value:t._id,children:t.title},t._id))]})]})]})}),e.jsx(U,{children:e.jsxs(L,{children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:c?`Enrollments for ${O(c)}`:"All Enrollments"}),e.jsx(me,{component:pe,children:e.jsxs(je,{children:[e.jsx(ve,{children:e.jsxs(K,{children:[e.jsx(o,{children:"Student"}),e.jsx(o,{children:"Series"}),e.jsx(o,{children:"Activated"}),e.jsx(o,{children:"Expires"}),e.jsx(o,{children:"Progress"}),e.jsx(o,{children:"Status"}),e.jsx(o,{children:"Actions"})]})}),e.jsx(fe,{children:q.map(t=>{var r,l;return e.jsxs(K,{children:[e.jsx(o,{children:e.jsxs(h,{display:"flex",alignItems:"center",children:[e.jsx(ge,{sx:{mr:2,width:32,height:32},children:F(t.userId._id||t.userId).charAt(0).toUpperCase()}),e.jsxs(h,{children:[e.jsx(s,{variant:"body2",children:F(t.userId._id||t.userId)}),e.jsx(s,{variant:"caption",color:"textSecondary",children:G(t.userId._id||t.userId)})]})]})}),e.jsx(o,{children:e.jsx(s,{variant:"body2",children:O(t.seriesId._id||t.seriesId)})}),e.jsx(o,{children:new Date(t.activatedAt).toLocaleDateString()}),e.jsx(o,{children:t.expiresAt?new Date(t.expiresAt).toLocaleDateString():"No Expiry"}),e.jsx(o,{children:e.jsxs(h,{sx:{width:"100%"},children:[e.jsxs(h,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(h,{sx:{width:"100%",mr:1},children:e.jsx(Ae,{variant:"determinate",value:((r=t.progress)==null?void 0:r.testsAttempted)||0,sx:{height:8,borderRadius:5}})}),e.jsx(h,{sx:{minWidth:35},children:e.jsx(s,{variant:"body2",color:"text.secondary",children:((l=t.progress)==null?void 0:l.testsAttempted)||0})})]}),e.jsx(s,{variant:"caption",color:"textSecondary",children:"Tests attempted"})]})}),e.jsx(o,{children:e.jsx(Ie,{label:M(t)?"Expired":"Active",color:M(t)?"error":"success",size:"small"})}),e.jsxs(o,{children:[e.jsx(B,{size:"small",onClick:()=>g(t),color:"primary",children:e.jsx(ye,{})}),e.jsx(B,{size:"small",onClick:()=>T(t),color:"primary",children:e.jsx(Se,{})}),e.jsx(B,{size:"small",onClick:()=>ce(t._id),color:"error",children:e.jsx(Ee,{})})]})]},t._id)})})]})})]})}),e.jsxs(Q,{open:re,onClose:k,maxWidth:"md",fullWidth:!0,children:[e.jsx(X,{children:f?"Edit Enrollment":"Add New Enrollment"}),e.jsx(Y,{children:e.jsxs(a,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsxs(N,{fullWidth:!0,error:!!m.userId,children:[e.jsx(W,{children:"User"}),e.jsx(P,{value:n.userId,onChange:t=>j({...n,userId:t.target.value}),children:S.map(t=>e.jsxs(I,{value:t._id,children:[t.username," (",t.email,")"]},t._id))}),m.userId&&e.jsx(s,{variant:"caption",color:"error",children:m.userId})]})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsxs(N,{fullWidth:!0,error:!!m.seriesId,children:[e.jsx(W,{children:"Series"}),e.jsx(P,{value:n.seriesId,onChange:t=>j({...n,seriesId:t.target.value}),children:y.map(t=>e.jsx(I,{value:t._id,children:t.title},t._id))}),m.seriesId&&e.jsx(s,{variant:"caption",color:"error",children:m.seriesId})]})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(Z,{fullWidth:!0,label:"Activated At",type:"date",value:n.activatedAt,onChange:t=>j({...n,activatedAt:t.target.value}),error:!!m.activatedAt,helperText:m.activatedAt,InputLabelProps:{shrink:!0}})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(Z,{fullWidth:!0,label:"Expires At (Optional)",type:"date",value:n.expiresAt,onChange:t=>j({...n,expiresAt:t.target.value}),InputLabelProps:{shrink:!0}})})]})}),e.jsxs(ee,{children:[e.jsx(v,{onClick:k,children:"Cancel"}),e.jsx(v,{onClick:de,variant:"contained",disabled:R,sx:{bgcolor:"#4e73df"},children:R?"Saving...":f?"Update":"Create"})]})]}),e.jsx(Q,{open:!!i,onClose:()=>g(null),maxWidth:"md",fullWidth:!0,children:i&&e.jsxs(e.Fragment,{children:[e.jsx(X,{children:"Enrollment Details"}),e.jsx(Y,{children:e.jsxs(a,{container:!0,spacing:2,children:[e.jsxs(a,{item:!0,xs:12,children:[e.jsx(s,{variant:"h6",children:"Student Information"}),e.jsxs(s,{variant:"body2",children:["Name: ",F(i.userId._id||i.userId)]}),e.jsxs(s,{variant:"body2",children:["Email: ",G(i.userId._id||i.userId)]})]}),e.jsxs(a,{item:!0,xs:12,children:[e.jsx(s,{variant:"h6",children:"Series Information"}),e.jsxs(s,{variant:"body2",children:["Series: ",O(i.seriesId._id||i.seriesId)]})]}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsxs(s,{variant:"subtitle2",children:["Activated: ",new Date(i.activatedAt).toLocaleDateString()]})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsxs(s,{variant:"subtitle2",children:["Expires: ",i.expiresAt?new Date(i.expiresAt).toLocaleDateString():"No Expiry"]})}),e.jsxs(a,{item:!0,xs:12,children:[e.jsx(s,{variant:"h6",children:"Progress"}),e.jsxs(s,{variant:"body2",children:["Tests Attempted: ",((H=i.progress)==null?void 0:H.testsAttempted)||0]}),e.jsxs(s,{variant:"body2",children:["Average Score: ",((J=i.progress)==null?void 0:J.avgScore)||"N/A"]}),e.jsxs(s,{variant:"body2",children:["Last Attempt: ",(V=i.progress)!=null&&V.lastAttemptAt?new Date(i.progress.lastAttemptAt).toLocaleDateString():"No attempts yet"]})]})]})}),e.jsxs(ee,{children:[e.jsx(v,{onClick:()=>g(null),children:"Close"}),e.jsx(v,{onClick:()=>{g(null),T(i)},variant:"contained",sx:{bgcolor:"#4e73df"},children:"Edit"})]})]})})]})};export{ut as default};
