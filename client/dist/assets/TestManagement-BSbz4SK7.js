import{r as j,j as e}from"./react-BLQlKNq_.js";import{u as Te}from"./notistack-DWKSkMQ9.js";import{a as q}from"./index-B50ReYK6.js";import{F as C,a8 as te,v as O,am as E,b as o,G as T,H as S,J as M,f as p,al as a,B as _,an as A,w as Se,P as Me,x as Ae,j as De,T as se,a as h,y as ke,I as Q,aj as Ie,ao as we,ap as ie,af as re,ag as ae,ah as le,av as $e,aw as ne,R as u,ar as We,as as Pe,ax as k,ay as Oe,az as Ee,aA as Qe,aB as Be,aC as Fe,ai as oe,au as ce,at as ze,aD as Ne}from"./@mui-DAjQFfGe.js";import"./@babel-HOuxngs4.js";import"./react-dom-DmmE3xc2.js";import"./scheduler-CzFDRTuY.js";import"./goober-DovPBWGu.js";import"./react-router-dom-BCp3cZHX.js";import"./react-router-CeklShVs.js";import"./@remix-run-CbFatO5U.js";import"./react-redux-10GvvXuy.js";import"./use-sync-external-store-De7g8zNk.js";import"./axios-Cm0UX6qg.js";import"./@reduxjs-DVdFRU_h.js";import"./redux-DITMfSWq.js";import"./immer-BWU1mfoO.js";import"./reselect-BeKUwQU7.js";import"./redux-thunk-ClJT1hhx.js";import"./react-typed-DYA10Kre.js";import"./typed.js-exEGtOgn.js";import"./react-bootstrap-sweetalert-DQB2ynYp.js";import"./prop-types-C1xvqhu3.js";import"./swiper-DTKdPQEP.js";import"./fslightbox-react-CQdsEJ3s.js";import"./react-bootstrap-C0bN-j8n.js";import"./classnames-BfIYw_zE.js";import"./@restart-JOvkJ3VN.js";import"./dom-helpers-nL1pTuZz.js";import"./react-transition-group-DSzsIoyj.js";import"./react-lazyload-DZ8paPqQ.js";import"./react-loading-skeleton-D7jF0Q-E.js";import"./@emotion-C2ZuPDAx.js";import"./hoist-non-react-statics-Buxaj0Kl.js";import"./react-is-8JwjhRSi.js";import"./stylis-NkKAe6Bn.js";import"./clsx-B-dksMZM.js";import"./@popperjs-BQBsAJpH.js";const Mt=()=>{var G,J,K;const[D,ue]=j.useState([]),[U,de]=j.useState([]),[R,g]=j.useState(!1),[he,V]=j.useState(!1),[f,B]=j.useState(null),[c,I]=j.useState(null),[m,xe]=j.useState(""),[F,je]=j.useState(0),{enqueueSnackbar:b}=Te(),[r,d]=j.useState({seriesId:"",title:"",description:"",subjects:[],mode:"Practice",durationMin:"",totalMarks:"",availability:{startAt:"",endAt:""},questions:[],isPublished:!1}),[l,z]=j.useState({}),H=["biology","chemistry","physics","english","mathematics","logic"],me=["Exam","Practice"];j.useEffect(()=>{pe()},[]),j.useEffect(()=>{m&&w(m)},[m]);const pe=async()=>{try{const t=await q.get("/series/all");de(t.data||[])}catch{b("Failed to fetch series",{variant:"error"})}},w=async t=>{try{g(!0);const s=await q.get(`/tests/series/${t}`);ue(s.data||[])}catch{b("Failed to fetch tests",{variant:"error"})}finally{g(!1)}},N=(t=null)=>{var s,i;t?(B(t),d({seriesId:t.seriesId,title:t.title,description:t.description||"",subjects:t.subjects,mode:t.mode,durationMin:t.durationMin,totalMarks:t.totalMarks,availability:{startAt:(s=t.availability)!=null&&s.startAt?new Date(t.availability.startAt).toISOString().split("T")[0]:"",endAt:(i=t.availability)!=null&&i.endAt?new Date(t.availability.endAt).toISOString().split("T")[0]:""},questions:t.questions?t.questions.map(n=>({_id:n.questionId._id,question:n.questionId.question,options:n.questionId.options,correctOption:n.questionId.correctOption,subject:n.questionId.subject,chapter:n.questionId.chapter,topic:n.questionId.topic,difficulty:n.questionId.difficulty,category:n.questionId.category,course:n.questionId.course,info:n.questionId.info||"",explain:n.questionId.explain||"",imageUrl:n.questionId.imageUrl||"",marks:n.marks})):[],isPublished:t.isPublished})):(B(null),d({seriesId:m,title:"",description:"",subjects:[],mode:"Practice",durationMin:"",totalMarks:"",availability:{startAt:"",endAt:""},questions:[],isPublished:!1})),z({}),V(!0)},L=()=>{V(!1),B(null),z({})},be=()=>{const t={};return r.seriesId||(t.seriesId="Series is required"),r.title||(t.title="Title is required"),r.subjects.length===0&&(t.subjects="At least one subject is required"),r.durationMin||(t.durationMin="Duration is required"),r.totalMarks||(t.totalMarks="Total marks is required"),r.questions.length===0&&(t.questions="At least one MCQ is required"),r.questions.forEach((s,i)=>{s.question||(t[`mcq_${i}_question`]="Question is required"),(!s.options||s.options.length!==4||s.options.some(n=>!n))&&(t[`mcq_${i}_options`]="All 4 options are required"),(s.correctOption<0||s.correctOption>3)&&(t[`mcq_${i}_correctOption`]="Correct option must be A, B, C, or D"),s.subject||(t[`mcq_${i}_subject`]="Subject is required"),s.chapter||(t[`mcq_${i}_chapter`]="Chapter is required"),s.topic||(t[`mcq_${i}_topic`]="Topic is required")}),z(t),Object.keys(t).length===0},ve=async()=>{var t,s,i,n,P,X,Y;if(be())try{g(!0);const v={...r,durationMin:Number(r.durationMin),totalMarks:Number(r.totalMarks),availability:{startAt:r.availability.startAt?new Date(r.availability.startAt):void 0,endAt:r.availability.endAt?new Date(r.availability.endAt):void 0}};if(console.log("Submitting test data:",{editing:!!f,testId:f==null?void 0:f._id,questionsCount:(t=v.questions)==null?void 0:t.length,questions:(s=v.questions)==null?void 0:s.map(y=>{var Z,ee;return{id:y._id,question:((Z=y.question)==null?void 0:Z.substring(0,30))+"...",options:(ee=y.options)==null?void 0:ee.length}})}),f){const y=await q.put(`/tests/${f._id}`,v);console.log("Test update response:",y.data),b("Test updated successfully",{variant:"success"})}else{const y=await q.post("/tests",v);console.log("Test create response:",y.data),b("Test created successfully",{variant:"success"})}L(),w(m)}catch(v){console.error("Test operation error:",((i=v.response)==null?void 0:i.data)||v),b(((P=(n=v.response)==null?void 0:n.data)==null?void 0:P.error)||((Y=(X=v.response)==null?void 0:X.data)==null?void 0:Y.details)||"Operation failed",{variant:"error"})}finally{g(!1)}},ge=async t=>{if(window.confirm("Are you sure you want to delete this test? This action cannot be undone."))try{g(!0),await q.delete(`/tests/${t}`),b("Test deleted successfully",{variant:"success"}),w(m)}catch{b("Failed to delete test",{variant:"error"})}finally{g(!1)}},fe=async(t,s)=>{try{g(!0),await q.patch(`/tests/${t}/publish`,{isPublished:!s}),b(`Test ${s?"unpublished":"published"} successfully`,{variant:"success"}),w(m)}catch{b("Failed to update test status",{variant:"error"})}finally{g(!1)}},ye=t=>{d({...r,subjects:t.target.value})},Ce=(t,s)=>{je(s)},_e=()=>{const t={_id:Date.now().toString(),question:"",options:["","","",""],correctOption:0,subject:"",chapter:"",topic:"",difficulty:"easy",category:"normal",course:"mdcat",info:"",explain:"",imageUrl:"",marks:1};d({...r,questions:[...r.questions,t]})},x=(t,s,i)=>{const n=[...r.questions];if(s.startsWith("option")){const P=parseInt(s.slice(-1))-1;n[t].options[P]=i}else n[t][s]=i;d({...r,questions:n})},qe=t=>{const s=r.questions.filter((i,n)=>n!==t);d({...r,questions:s})},$=(t,s,i,n)=>e.jsx(O,{sx:{minWidth:275,bgcolor:n},children:e.jsx(E,{children:e.jsxs(_,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(_,{children:[e.jsx(o,{variant:"h6",component:"div",color:"white",children:t}),e.jsx(o,{variant:"h4",component:"div",color:"white",children:s})]}),e.jsx(_,{color:"white",children:i})]})})}),W=U.find(t=>t._id===m);return e.jsxs("div",{className:"container-fluid",children:[e.jsxs("div",{className:"d-sm-flex align-items-center justify-content-between mb-4",children:[e.jsx("h1",{className:"h3 mb-0 text-gray-800",children:"Test Management"}),m&&e.jsx(C,{variant:"contained",startIcon:e.jsx(te,{}),onClick:()=>N(),sx:{bgcolor:"#4e73df"},children:"Add New Test"})]}),e.jsx(O,{sx:{mb:4},children:e.jsxs(E,{children:[e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Select Series"}),e.jsxs(T,{fullWidth:!0,children:[e.jsx(S,{children:"Choose Series"}),e.jsx(M,{value:m,onChange:t=>xe(t.target.value),children:U.map(t=>e.jsx(p,{value:t._id,children:t.title},t._id))})]})]})}),m&&e.jsxs(e.Fragment,{children:[e.jsxs(a,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(a,{item:!0,xs:12,sm:6,md:3,children:$("Total Tests",D.length,e.jsx(ce,{}),"#4e73df")}),e.jsx(a,{item:!0,xs:12,sm:6,md:3,children:$("Published Tests",D.filter(t=>t.isPublished).length,e.jsx(ze,{}),"#1cc88a")}),e.jsx(a,{item:!0,xs:12,sm:6,md:3,children:$("Total Duration",`${D.reduce((t,s)=>t+s.durationMin,0)} min`,e.jsx(Ne,{}),"#f6c23e")}),e.jsx(a,{item:!0,xs:12,sm:6,md:3,children:$("Total Questions",D.reduce((t,s)=>{var i;return t+(((i=s.questions)==null?void 0:i.length)||0)},0),e.jsx(ce,{}),"#e74a3b")})]}),W&&e.jsx(O,{sx:{mb:4},children:e.jsxs(E,{children:[e.jsxs(o,{variant:"h6",gutterBottom:!0,children:["Series: ",W.title]}),e.jsx(o,{variant:"body2",color:"textSecondary",children:W.description}),e.jsx(_,{sx:{mt:2},children:W.subjects.map((t,s)=>e.jsx(A,{label:t,size:"small",sx:{mr:1,mb:1}},s))})]})}),e.jsx(O,{children:e.jsxs(E,{children:[e.jsx(o,{variant:"h6",gutterBottom:!0,children:"Tests in Series"}),e.jsx(Se,{component:Me,children:e.jsxs(Ae,{children:[e.jsx(De,{children:e.jsxs(se,{children:[e.jsx(h,{children:"Title"}),e.jsx(h,{children:"Mode"}),e.jsx(h,{children:"Subjects"}),e.jsx(h,{children:"Duration"}),e.jsx(h,{children:"Questions"}),e.jsx(h,{children:"Status"}),e.jsx(h,{children:"Actions"})]})}),e.jsx(ke,{children:D.map(t=>{var s;return e.jsxs(se,{children:[e.jsxs(h,{children:[e.jsx(o,{variant:"body2",children:t.title}),t.description&&e.jsxs(o,{variant:"caption",color:"textSecondary",children:[t.description.substring(0,50),"..."]})]}),e.jsx(h,{children:e.jsx(A,{label:t.mode,size:"small",color:t.mode==="Exam"?"error":"primary"})}),e.jsx(h,{children:t.subjects.map((i,n)=>e.jsx(A,{label:i,size:"small",sx:{mr:.5,mb:.5}},n))}),e.jsxs(h,{children:[t.durationMin," min"]}),e.jsx(h,{children:((s=t.questions)==null?void 0:s.length)||0}),e.jsx(h,{children:e.jsx(A,{label:t.isPublished?"Published":"Draft",color:t.isPublished?"success":"default",size:"small"})}),e.jsxs(h,{children:[e.jsx(Q,{size:"small",onClick:()=>I(t),color:"primary",children:e.jsx(Ie,{})}),e.jsx(Q,{size:"small",onClick:()=>N(t),color:"primary",children:e.jsx(we,{})}),e.jsx(Q,{size:"small",onClick:()=>fe(t._id,t.isPublished),color:t.isPublished?"warning":"success",children:t.isPublished?"Unpublish":"Publish"}),e.jsx(Q,{size:"small",onClick:()=>ge(t._id),color:"error",children:e.jsx(ie,{})})]})]},t._id)})})]})})]})})]}),e.jsxs(re,{open:he,onClose:L,maxWidth:"lg",fullWidth:!0,children:[e.jsx(ae,{children:f?"Edit Test":"Add New Test"}),e.jsxs(le,{children:[e.jsxs($e,{value:F,onChange:Ce,sx:{mb:2},children:[e.jsx(ne,{label:"Test Details"}),e.jsx(ne,{label:"MCQ Management"})]}),F===0&&e.jsxs(a,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(u,{fullWidth:!0,label:"Title",value:r.title,onChange:t=>d({...r,title:t.target.value}),error:!!l.title,helperText:l.title})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsxs(T,{fullWidth:!0,children:[e.jsx(S,{children:"Mode"}),e.jsx(M,{value:r.mode,onChange:t=>d({...r,mode:t.target.value}),children:me.map(t=>e.jsx(p,{value:t,children:t},t))})]})}),e.jsx(a,{item:!0,xs:12,children:e.jsx(u,{fullWidth:!0,label:"Description",value:r.description,onChange:t=>d({...r,description:t.target.value}),multiline:!0,rows:3})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsxs(T,{fullWidth:!0,error:!!l.subjects,children:[e.jsx(S,{children:"Subjects"}),e.jsx(M,{multiple:!0,value:r.subjects,onChange:ye,renderValue:t=>e.jsx(_,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:t.map(s=>e.jsx(A,{label:s,size:"small"},s))}),children:H.map(t=>e.jsx(p,{value:t,children:t},t))}),l.subjects&&e.jsx(o,{variant:"caption",color:"error",children:l.subjects})]})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(u,{fullWidth:!0,label:"Duration (minutes)",type:"number",value:r.durationMin,onChange:t=>d({...r,durationMin:t.target.value}),error:!!l.durationMin,helperText:l.durationMin})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(u,{fullWidth:!0,label:"Total Marks",type:"number",value:r.totalMarks,onChange:t=>d({...r,totalMarks:t.target.value}),error:!!l.totalMarks,helperText:l.totalMarks})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(u,{fullWidth:!0,label:"Start Date",type:"date",value:r.availability.startAt,onChange:t=>d({...r,availability:{...r.availability,startAt:t.target.value}}),InputLabelProps:{shrink:!0}})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(u,{fullWidth:!0,label:"End Date",type:"date",value:r.availability.endAt,onChange:t=>d({...r,availability:{...r.availability,endAt:t.target.value}}),InputLabelProps:{shrink:!0}})}),e.jsx(a,{item:!0,xs:12,children:e.jsx(We,{control:e.jsx(Pe,{checked:r.isPublished,onChange:t=>d({...r,isPublished:t.target.checked})}),label:"Published"})})]}),F===1&&e.jsxs(_,{children:[e.jsxs(_,{sx:{mb:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(o,{variant:"h6",children:["MCQs: ",r.questions.length]}),e.jsx(C,{variant:"outlined",startIcon:e.jsx(te,{}),onClick:_e,children:"Add MCQ"})]}),l.questions&&e.jsx(k,{severity:"error",sx:{mb:2},children:l.questions}),r.questions.length>0?e.jsx(Oe,{children:r.questions.map((t,s)=>e.jsxs(Ee,{children:[e.jsx(Qe,{expandIcon:e.jsx(Be,{}),children:e.jsxs(o,{children:["MCQ ",s+1,": ",t.question||"New Question"]})}),e.jsx(Fe,{children:e.jsxs(a,{container:!0,spacing:2,children:[e.jsx(a,{item:!0,xs:12,children:e.jsx(u,{fullWidth:!0,label:"Question",value:t.question,onChange:i=>x(s,"question",i.target.value),multiline:!0,rows:3,error:!!l[`mcq_${s}_question`],helperText:l[`mcq_${s}_question`]})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(u,{fullWidth:!0,label:"Option A",value:t.options[0],onChange:i=>x(s,"option1",i.target.value),error:!!l[`mcq_${s}_options`]})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(u,{fullWidth:!0,label:"Option B",value:t.options[1],onChange:i=>x(s,"option2",i.target.value),error:!!l[`mcq_${s}_options`]})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(u,{fullWidth:!0,label:"Option C",value:t.options[2],onChange:i=>x(s,"option3",i.target.value),error:!!l[`mcq_${s}_options`]})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(u,{fullWidth:!0,label:"Option D",value:t.options[3],onChange:i=>x(s,"option4",i.target.value),error:!!l[`mcq_${s}_options`]})}),l[`mcq_${s}_options`]&&e.jsx(a,{item:!0,xs:12,children:e.jsx(k,{severity:"error",sx:{mt:1},children:l[`mcq_${s}_options`]})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsxs(T,{fullWidth:!0,error:!!l[`mcq_${s}_correctOption`],children:[e.jsx(S,{children:"Correct Option"}),e.jsxs(M,{value:t.correctOption,onChange:i=>x(s,"correctOption",i.target.value),children:[e.jsx(p,{value:0,children:"A"}),e.jsx(p,{value:1,children:"B"}),e.jsx(p,{value:2,children:"C"}),e.jsx(p,{value:3,children:"D"})]})]})}),l[`mcq_${s}_correctOption`]&&e.jsx(a,{item:!0,xs:12,children:e.jsx(k,{severity:"error",sx:{mt:1},children:l[`mcq_${s}_correctOption`]})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsxs(T,{fullWidth:!0,error:!!l[`mcq_${s}_subject`],children:[e.jsx(S,{children:"Subject"}),e.jsx(M,{value:t.subject,onChange:i=>x(s,"subject",i.target.value),children:H.map(i=>e.jsx(p,{value:i,children:i.charAt(0).toUpperCase()+i.slice(1)},i))})]})}),l[`mcq_${s}_subject`]&&e.jsx(a,{item:!0,xs:12,children:e.jsx(k,{severity:"error",sx:{mt:1},children:l[`mcq_${s}_subject`]})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(u,{fullWidth:!0,label:"Chapter",value:t.chapter,onChange:i=>x(s,"chapter",i.target.value),error:!!l[`mcq_${s}_chapter`],helperText:l[`mcq_${s}_chapter`]})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(u,{fullWidth:!0,label:"Topic",value:t.topic,onChange:i=>x(s,"topic",i.target.value),error:!!l[`mcq_${s}_topic`],helperText:l[`mcq_${s}_topic`]})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsxs(T,{fullWidth:!0,children:[e.jsx(S,{children:"Difficulty"}),e.jsxs(M,{value:t.difficulty,onChange:i=>x(s,"difficulty",i.target.value),children:[e.jsx(p,{value:"easy",children:"Easy"}),e.jsx(p,{value:"medium",children:"Medium"}),e.jsx(p,{value:"hard",children:"Hard"})]})]})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(u,{fullWidth:!0,label:"Marks",type:"number",value:t.marks,onChange:i=>x(s,"marks",Number(i.target.value))})}),e.jsx(a,{item:!0,xs:12,children:e.jsx(u,{fullWidth:!0,label:"Explanation",value:t.explain,onChange:i=>x(s,"explain",i.target.value),multiline:!0,rows:2})}),e.jsx(a,{item:!0,xs:12,children:e.jsx(C,{variant:"outlined",color:"error",onClick:()=>qe(s),startIcon:e.jsx(ie,{}),children:"Remove MCQ"})})]})})]},t._id||s))}):e.jsx(k,{severity:"info",children:'No MCQs added yet. Click "Add MCQ" to create questions for this test.'})]})]}),e.jsxs(oe,{children:[e.jsx(C,{onClick:L,children:"Cancel"}),e.jsx(C,{onClick:ve,variant:"contained",disabled:R,sx:{bgcolor:"#4e73df"},children:R?"Saving...":f?"Update":"Create"})]})]}),e.jsx(re,{open:!!c,onClose:()=>I(null),maxWidth:"md",fullWidth:!0,children:c&&e.jsxs(e.Fragment,{children:[e.jsx(ae,{children:"Test Details"}),e.jsx(le,{children:e.jsxs(a,{container:!0,spacing:2,children:[e.jsxs(a,{item:!0,xs:12,children:[e.jsx(o,{variant:"h6",children:c.title}),e.jsx(o,{variant:"body2",color:"textSecondary",children:c.description})]}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsxs(o,{variant:"subtitle2",children:["Mode: ",c.mode]})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsxs(o,{variant:"subtitle2",children:["Duration: ",c.durationMin," minutes"]})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsxs(o,{variant:"subtitle2",children:["Total Marks: ",c.totalMarks]})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsxs(o,{variant:"subtitle2",children:["Status: ",c.isPublished?"Published":"Draft"]})}),e.jsxs(a,{item:!0,xs:12,children:[e.jsx(o,{variant:"subtitle2",children:"Subjects:"}),c.subjects.map((t,s)=>e.jsx(A,{label:t,size:"small",sx:{mr:.5,mb:.5}},s))]}),e.jsx(a,{item:!0,xs:12,children:e.jsxs(o,{variant:"subtitle2",children:["Questions: ",((G=c.questions)==null?void 0:G.length)||0]})}),((J=c.availability)==null?void 0:J.startAt)&&e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsxs(o,{variant:"subtitle2",children:["Start Date: ",new Date(c.availability.startAt).toLocaleDateString()]})}),((K=c.availability)==null?void 0:K.endAt)&&e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsxs(o,{variant:"subtitle2",children:["End Date: ",new Date(c.availability.endAt).toLocaleDateString()]})})]})}),e.jsxs(oe,{children:[e.jsx(C,{onClick:()=>I(null),children:"Close"}),e.jsx(C,{onClick:()=>{I(null),N(c)},variant:"contained",sx:{bgcolor:"#4e73df"},children:"Edit"})]})]})})]})};export{Mt as default};
