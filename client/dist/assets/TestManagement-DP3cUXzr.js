import{r as u,j as e}from"./react-BLQlKNq_.js";import{u as ne}from"./notistack-DWKSkMQ9.js";import{a as m}from"./index-BZIQzIKv.js";import{F as f,a8 as oe,v as k,am as D,b as r,G as W,H as F,J as q,f as z,al as a,B as g,an as b,w as de,P as ce,x as ue,j as he,T as $,a as n,y as xe,I as A,aj as je,ao as me,ap as be,af as R,ag as G,ah as H,R as p,aq as pe,ar as ve,ai as U,at as V,as as fe,au as ge}from"./@mui-JR0bzeok.js";import"./@babel-HOuxngs4.js";import"./react-dom-DmmE3xc2.js";import"./scheduler-CzFDRTuY.js";import"./goober-DovPBWGu.js";import"./react-router-dom-BCp3cZHX.js";import"./react-router-CeklShVs.js";import"./@remix-run-CbFatO5U.js";import"./react-redux-10GvvXuy.js";import"./use-sync-external-store-De7g8zNk.js";import"./axios-Cm0UX6qg.js";import"./@reduxjs-DVdFRU_h.js";import"./redux-DITMfSWq.js";import"./immer-BWU1mfoO.js";import"./reselect-BeKUwQU7.js";import"./redux-thunk-ClJT1hhx.js";import"./react-typed-DYA10Kre.js";import"./typed.js-exEGtOgn.js";import"./react-bootstrap-sweetalert-DQB2ynYp.js";import"./prop-types-C1xvqhu3.js";import"./swiper-DTKdPQEP.js";import"./fslightbox-react-CQdsEJ3s.js";import"./react-bootstrap-C0bN-j8n.js";import"./classnames-BfIYw_zE.js";import"./@restart-JOvkJ3VN.js";import"./dom-helpers-nL1pTuZz.js";import"./react-transition-group-DSzsIoyj.js";import"./react-lazyload-DZ8paPqQ.js";import"./react-loading-skeleton-D7jF0Q-E.js";import"./@emotion-C2ZuPDAx.js";import"./hoist-non-react-statics-Buxaj0Kl.js";import"./react-is-8JwjhRSi.js";import"./stylis-NkKAe6Bn.js";import"./clsx-B-dksMZM.js";import"./@popperjs-BQBsAJpH.js";const rt=()=>{var _,O;const[v,J]=u.useState([]),[B,K]=u.useState([]),[L,j]=u.useState(!1),[Q,N]=u.useState(!1),[y,w]=u.useState(null),[l,S]=u.useState(null),[d,X]=u.useState(""),{enqueueSnackbar:h}=ne(),[s,c]=u.useState({seriesId:"",title:"",description:"",subjects:[],mode:"Practice",durationMin:"",totalMarks:"",availability:{startAt:"",endAt:""},questions:[],isPublished:!1}),[x,P]=u.useState({}),Y=["Biology","Chemistry","Physics","English","Mathematics","Logic"],Z=["Exam","Practice"];u.useEffect(()=>{ee()},[]),u.useEffect(()=>{d&&T(d)},[d]);const ee=async()=>{try{const t=await m.get("/series/all");K(t.data)}catch{h("Failed to fetch series",{variant:"error"})}},T=async t=>{try{j(!0);const i=await m.get(`/tests/series/${t}`);J(i.data)}catch{h("Failed to fetch tests",{variant:"error"})}finally{j(!1)}},I=(t=null)=>{var i,o;t?(w(t),c({seriesId:t.seriesId,title:t.title,description:t.description||"",subjects:t.subjects,mode:t.mode,durationMin:t.durationMin,totalMarks:t.totalMarks,availability:{startAt:(i=t.availability)!=null&&i.startAt?new Date(t.availability.startAt).toISOString().split("T")[0]:"",endAt:(o=t.availability)!=null&&o.endAt?new Date(t.availability.endAt).toISOString().split("T")[0]:""},questions:t.questions||[],isPublished:t.isPublished})):(w(null),c({seriesId:d,title:"",description:"",subjects:[],mode:"Practice",durationMin:"",totalMarks:"",availability:{startAt:"",endAt:""},questions:[],isPublished:!1})),P({}),N(!0)},E=()=>{N(!1),w(null),P({})},te=()=>{const t={};return s.seriesId||(t.seriesId="Series is required"),s.title||(t.title="Title is required"),s.subjects.length===0&&(t.subjects="At least one subject is required"),s.durationMin||(t.durationMin="Duration is required"),s.totalMarks||(t.totalMarks="Total marks is required"),P(t),Object.keys(t).length===0},se=async()=>{var t,i;if(te())try{j(!0);const o={...s,durationMin:Number(s.durationMin),totalMarks:Number(s.totalMarks),availability:{startAt:s.availability.startAt?new Date(s.availability.startAt):void 0,endAt:s.availability.endAt?new Date(s.availability.endAt):void 0}};y?(await m.put(`/tests/${y._id}`,o),h("Test updated successfully",{variant:"success"})):(await m.post("/tests",o),h("Test created successfully",{variant:"success"})),E(),T(d)}catch(o){h(((i=(t=o.response)==null?void 0:t.data)==null?void 0:i.error)||"Operation failed",{variant:"error"})}finally{j(!1)}},ie=async t=>{if(window.confirm("Are you sure you want to delete this test? This action cannot be undone."))try{j(!0),await m.delete(`/tests/${t}`),h("Test deleted successfully",{variant:"success"}),T(d)}catch{h("Failed to delete test",{variant:"error"})}finally{j(!1)}},ae=async(t,i)=>{try{j(!0),await m.patch(`/tests/${t}/publish`,{isPublished:!i}),h(`Test ${i?"unpublished":"published"} successfully`,{variant:"success"}),T(d)}catch{h("Failed to update test status",{variant:"error"})}finally{j(!1)}},re=t=>{c({...s,subjects:t.target.value})},M=(t,i,o,le)=>e.jsx(k,{sx:{minWidth:275,bgcolor:le},children:e.jsx(D,{children:e.jsxs(g,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(g,{children:[e.jsx(r,{variant:"h6",component:"div",color:"white",children:t}),e.jsx(r,{variant:"h4",component:"div",color:"white",children:i})]}),e.jsx(g,{color:"white",children:o})]})})}),C=B.find(t=>t._id===d);return e.jsxs("div",{className:"container-fluid",children:[e.jsxs("div",{className:"d-sm-flex align-items-center justify-content-between mb-4",children:[e.jsx("h1",{className:"h3 mb-0 text-gray-800",children:"Test Management"}),d&&e.jsx(f,{variant:"contained",startIcon:e.jsx(oe,{}),onClick:()=>I(),sx:{bgcolor:"#4e73df"},children:"Add New Test"})]}),e.jsx(k,{sx:{mb:4},children:e.jsxs(D,{children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Select Series"}),e.jsxs(W,{fullWidth:!0,children:[e.jsx(F,{children:"Choose Series"}),e.jsx(q,{value:d,onChange:t=>X(t.target.value),children:B.map(t=>e.jsx(z,{value:t._id,children:t.title},t._id))})]})]})}),d&&e.jsxs(e.Fragment,{children:[e.jsxs(a,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(a,{item:!0,xs:12,sm:6,md:3,children:M("Total Tests",v.length,e.jsx(V,{}),"#4e73df")}),e.jsx(a,{item:!0,xs:12,sm:6,md:3,children:M("Published Tests",v.filter(t=>t.isPublished).length,e.jsx(fe,{}),"#1cc88a")}),e.jsx(a,{item:!0,xs:12,sm:6,md:3,children:M("Total Duration",`${v.reduce((t,i)=>t+i.durationMin,0)} min`,e.jsx(ge,{}),"#f6c23e")}),e.jsx(a,{item:!0,xs:12,sm:6,md:3,children:M("Total Marks",v.reduce((t,i)=>t+i.totalMarks,0),e.jsx(V,{}),"#e74a3b")})]}),C&&e.jsx(k,{sx:{mb:4},children:e.jsxs(D,{children:[e.jsxs(r,{variant:"h6",gutterBottom:!0,children:["Series: ",C.title]}),e.jsx(r,{variant:"body2",color:"textSecondary",children:C.description}),e.jsx(g,{sx:{mt:2},children:C.subjects.map((t,i)=>e.jsx(b,{label:t,size:"small",sx:{mr:1,mb:1}},i))})]})}),e.jsx(k,{children:e.jsxs(D,{children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Tests in Series"}),e.jsx(de,{component:ce,children:e.jsxs(ue,{children:[e.jsx(he,{children:e.jsxs($,{children:[e.jsx(n,{children:"Title"}),e.jsx(n,{children:"Mode"}),e.jsx(n,{children:"Subjects"}),e.jsx(n,{children:"Duration"}),e.jsx(n,{children:"Marks"}),e.jsx(n,{children:"Status"}),e.jsx(n,{children:"Actions"})]})}),e.jsx(xe,{children:v.map(t=>e.jsxs($,{children:[e.jsxs(n,{children:[e.jsx(r,{variant:"body2",children:t.title}),t.description&&e.jsxs(r,{variant:"caption",color:"textSecondary",children:[t.description.substring(0,50),"..."]})]}),e.jsx(n,{children:e.jsx(b,{label:t.mode,size:"small",color:t.mode==="Exam"?"error":"primary"})}),e.jsx(n,{children:t.subjects.map((i,o)=>e.jsx(b,{label:i,size:"small",sx:{mr:.5,mb:.5}},o))}),e.jsxs(n,{children:[t.durationMin," min"]}),e.jsx(n,{children:t.totalMarks}),e.jsx(n,{children:e.jsx(b,{label:t.isPublished?"Published":"Draft",color:t.isPublished?"success":"default",size:"small"})}),e.jsxs(n,{children:[e.jsx(A,{size:"small",onClick:()=>S(t),color:"primary",children:e.jsx(je,{})}),e.jsx(A,{size:"small",onClick:()=>I(t),color:"primary",children:e.jsx(me,{})}),e.jsx(A,{size:"small",onClick:()=>ae(t._id,t.isPublished),color:t.isPublished?"warning":"success",children:t.isPublished?"Unpublish":"Publish"}),e.jsx(A,{size:"small",onClick:()=>ie(t._id),color:"error",children:e.jsx(be,{})})]})]},t._id))})]})})]})})]}),e.jsxs(R,{open:Q,onClose:E,maxWidth:"md",fullWidth:!0,children:[e.jsx(G,{children:y?"Edit Test":"Add New Test"}),e.jsx(H,{children:e.jsxs(a,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(p,{fullWidth:!0,label:"Title",value:s.title,onChange:t=>c({...s,title:t.target.value}),error:!!x.title,helperText:x.title})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsxs(W,{fullWidth:!0,children:[e.jsx(F,{children:"Mode"}),e.jsx(q,{value:s.mode,onChange:t=>c({...s,mode:t.target.value}),children:Z.map(t=>e.jsx(z,{value:t,children:t},t))})]})}),e.jsx(a,{item:!0,xs:12,children:e.jsx(p,{fullWidth:!0,label:"Description",value:s.description,onChange:t=>c({...s,description:t.target.value}),multiline:!0,rows:3})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsxs(W,{fullWidth:!0,error:!!x.subjects,children:[e.jsx(F,{children:"Subjects"}),e.jsx(q,{multiple:!0,value:s.subjects,onChange:re,renderValue:t=>e.jsx(g,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:t.map(i=>e.jsx(b,{label:i,size:"small"},i))}),children:Y.map(t=>e.jsx(z,{value:t,children:t},t))}),x.subjects&&e.jsx(r,{variant:"caption",color:"error",children:x.subjects})]})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(p,{fullWidth:!0,label:"Duration (minutes)",type:"number",value:s.durationMin,onChange:t=>c({...s,durationMin:t.target.value}),error:!!x.durationMin,helperText:x.durationMin})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(p,{fullWidth:!0,label:"Total Marks",type:"number",value:s.totalMarks,onChange:t=>c({...s,totalMarks:t.target.value}),error:!!x.totalMarks,helperText:x.totalMarks})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(p,{fullWidth:!0,label:"Start Date",type:"date",value:s.availability.startAt,onChange:t=>c({...s,availability:{...s.availability,startAt:t.target.value}}),InputLabelProps:{shrink:!0}})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(p,{fullWidth:!0,label:"End Date",type:"date",value:s.availability.endAt,onChange:t=>c({...s,availability:{...s.availability,endAt:t.target.value}}),InputLabelProps:{shrink:!0}})}),e.jsx(a,{item:!0,xs:12,children:e.jsx(pe,{control:e.jsx(ve,{checked:s.isPublished,onChange:t=>c({...s,isPublished:t.target.checked})}),label:"Published"})})]})}),e.jsxs(U,{children:[e.jsx(f,{onClick:E,children:"Cancel"}),e.jsx(f,{onClick:se,variant:"contained",disabled:L,sx:{bgcolor:"#4e73df"},children:L?"Saving...":y?"Update":"Create"})]})]}),e.jsx(R,{open:!!l,onClose:()=>S(null),maxWidth:"md",fullWidth:!0,children:l&&e.jsxs(e.Fragment,{children:[e.jsx(G,{children:"Test Details"}),e.jsx(H,{children:e.jsxs(a,{container:!0,spacing:2,children:[e.jsxs(a,{item:!0,xs:12,children:[e.jsx(r,{variant:"h6",children:l.title}),e.jsx(r,{variant:"body2",color:"textSecondary",children:l.description})]}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsxs(r,{variant:"subtitle2",children:["Mode: ",l.mode]})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsxs(r,{variant:"subtitle2",children:["Duration: ",l.durationMin," minutes"]})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsxs(r,{variant:"subtitle2",children:["Total Marks: ",l.totalMarks]})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsxs(r,{variant:"subtitle2",children:["Status: ",l.isPublished?"Published":"Draft"]})}),e.jsxs(a,{item:!0,xs:12,children:[e.jsx(r,{variant:"subtitle2",children:"Subjects:"}),l.subjects.map((t,i)=>e.jsx(b,{label:t,size:"small",sx:{mr:.5,mb:.5}},i))]}),((_=l.availability)==null?void 0:_.startAt)&&e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsxs(r,{variant:"subtitle2",children:["Start Date: ",new Date(l.availability.startAt).toLocaleDateString()]})}),((O=l.availability)==null?void 0:O.endAt)&&e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsxs(r,{variant:"subtitle2",children:["End Date: ",new Date(l.availability.endAt).toLocaleDateString()]})})]})}),e.jsxs(U,{children:[e.jsx(f,{onClick:()=>S(null),children:"Close"}),e.jsx(f,{onClick:()=>{S(null),I(l)},variant:"contained",sx:{bgcolor:"#4e73df"},children:"Edit"})]})]})})]})};export{rt as default};
