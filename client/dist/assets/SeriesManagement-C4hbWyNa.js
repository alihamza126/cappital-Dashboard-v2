import{r as d,j as e}from"./react-BLQlKNq_.js";import{u as ne}from"./notistack-DWKSkMQ9.js";import{a as f}from"./index-DCEUI2HW.js";import{F as p,a8 as oe,af as i,v as L,ag as N,b as a,w as ce,P as de,x as ue,j as xe,T as z,a as n,y as me,B as j,aj as v,I as U,ak as he,ar as pe,al as je,am as q,an as O,ao as K,R as x,as as ge,G as H,H as _,J as $,f as G,at as fe,au as ve,ap as V,av as be,aw as J,ad as ye}from"./@mui-Bw2wRnxu.js";import"./@babel-HOuxngs4.js";import"./react-dom-DmmE3xc2.js";import"./scheduler-CzFDRTuY.js";import"./goober-DovPBWGu.js";import"./react-router-dom-BCp3cZHX.js";import"./react-router-CeklShVs.js";import"./@remix-run-CbFatO5U.js";import"./react-redux-10GvvXuy.js";import"./use-sync-external-store-De7g8zNk.js";import"./axios-Cm0UX6qg.js";import"./@reduxjs-DVdFRU_h.js";import"./redux-DITMfSWq.js";import"./immer-BWU1mfoO.js";import"./reselect-BeKUwQU7.js";import"./redux-thunk-ClJT1hhx.js";import"./react-typed-DYA10Kre.js";import"./typed.js-exEGtOgn.js";import"./react-bootstrap-sweetalert-DQB2ynYp.js";import"./prop-types-C1xvqhu3.js";import"./swiper-DTKdPQEP.js";import"./fslightbox-react-CQdsEJ3s.js";import"./yet-another-react-lightbox-DocsD2co.js";import"./react-bootstrap-C0bN-j8n.js";import"./classnames-BfIYw_zE.js";import"./@restart-JOvkJ3VN.js";import"./dom-helpers-nL1pTuZz.js";import"./react-transition-group-DSzsIoyj.js";import"./react-lazyload-DZ8paPqQ.js";import"./react-loading-skeleton-D7jF0Q-E.js";import"./@emotion-C2ZuPDAx.js";import"./hoist-non-react-statics-Buxaj0Kl.js";import"./react-is-8JwjhRSi.js";import"./stylis-NkKAe6Bn.js";import"./clsx-B-dksMZM.js";import"./@popperjs-BQBsAJpH.js";const nt=()=>{var B;const[g,Q]=d.useState([]),[W,h]=d.useState(!1),[X,R]=d.useState(!1),[b,A]=d.useState(null),[c,y]=d.useState(null),{enqueueSnackbar:m}=ne(),[s,l]=d.useState({slug:"",title:"",coverImageUrl:"",description:"",subjects:[],difficulty:"Beginner",price:"",originalPrice:"",tags:[],totalTests:"",totalDurationMin:"",isActive:!0,expiresAt:""}),[k,M]=d.useState(null),[F,T]=d.useState(""),[o,D]=d.useState({}),Y=["Biology","Chemistry","Physics","English","Mathematics","Logic"],Z=["Beginner","Intermediate","Advanced"];d.useEffect(()=>{I()},[]);const I=async()=>{try{h(!0);const t=await f.get("/series/all");Q(t.data)}catch{m("Failed to fetch series",{variant:"error"})}finally{h(!1)}},w=(t=null)=>{t?(A(t),l({slug:t.slug,title:t.title,coverImageUrl:t.coverImageUrl||"",description:t.description,subjects:t.subjects,difficulty:t.difficulty,price:t.price,originalPrice:t.originalPrice||"",tags:t.tags||[],totalTests:t.totalTests,totalDurationMin:t.totalDurationMin||"",isActive:t.isActive,expiresAt:t.expiresAt?new Date(t.expiresAt).toISOString().split("T")[0]:""}),T(t.coverImageUrl||"")):(A(null),l({slug:"",title:"",coverImageUrl:"",description:"",subjects:[],difficulty:"Beginner",price:"",originalPrice:"",tags:[],totalTests:"",totalDurationMin:"",isActive:!0,expiresAt:""}),T("")),D({}),R(!0)},P=()=>{R(!1),A(null),D({}),M(null),T("")},ee=t=>{const r=t.target.files[0];r&&(M(r),T(URL.createObjectURL(r)))},te=()=>{const t={};return s.slug||(t.slug="Slug is required"),s.title||(t.title="Title is required"),s.description||(t.description="Description is required"),s.subjects.length===0&&(t.subjects="At least one subject is required"),s.price||(t.price="Price is required"),s.totalTests||(t.totalTests="Total tests is required"),D(t),Object.keys(t).length===0},se=async()=>{var t,r;if(te())try{h(!0);let u={...s,price:Number(s.price),originalPrice:s.originalPrice?Number(s.originalPrice):void 0,totalTests:Number(s.totalTests),totalDurationMin:s.totalDurationMin?Number(s.totalDurationMin):void 0,expiresAt:s.expiresAt?new Date(s.expiresAt):void 0};if(k){const C=new FormData;C.append("image",k);const ae={headers:{"Content-Type":"multipart/form-data"}},E=await f.post("/upload/img",C,ae);if(E.status===200)u.coverImageUrl=E.data.fileURL;else{m("Failed to upload image",{variant:"error"});return}}b?(await f.put(`/series/${b._id}`,u),m("Series updated successfully",{variant:"success"})):(await f.post("/series",u),m("Series created successfully",{variant:"success"})),P(),I()}catch(u){m(((r=(t=u.response)==null?void 0:t.data)==null?void 0:r.error)||"Operation failed",{variant:"error"})}finally{h(!1)}},ie=async t=>{if(window.confirm("Are you sure you want to delete this series? This action cannot be undone."))try{h(!0),await f.delete(`/series/${t}`),m("Series deleted successfully",{variant:"success"}),I()}catch{m("Failed to delete series",{variant:"error"})}finally{h(!1)}},re=t=>{l({...s,subjects:t.target.value})},le=t=>{const r=t.target.value;l({...s,tags:typeof r=="string"?r.split(","):r})},S=(t,r,u,C)=>e.jsx(L,{sx:{minWidth:275,bgcolor:C},children:e.jsx(N,{children:e.jsxs(j,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(j,{children:[e.jsx(a,{variant:"h6",component:"div",color:"white",children:t}),e.jsx(a,{variant:"h4",component:"div",color:"white",children:r})]}),e.jsx(j,{color:"white",children:u})]})})});return e.jsxs("div",{className:"container-fluid",children:[e.jsxs("div",{className:"d-sm-flex align-items-center justify-content-between mb-4",children:[e.jsx("h1",{className:"h3 mb-0 text-gray-800",children:"Series Management"}),e.jsx(p,{variant:"contained",startIcon:e.jsx(oe,{}),onClick:()=>w(),sx:{bgcolor:"#4e73df"},children:"Add New Series"})]}),e.jsxs(i,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(i,{item:!0,xs:12,sm:6,md:3,children:S("Total Series",g.length,e.jsx(be,{}),"#4e73df")}),e.jsx(i,{item:!0,xs:12,sm:6,md:3,children:S("Active Series",g.filter(t=>t.isActive).length,e.jsx(J,{}),"#1cc88a")}),e.jsx(i,{item:!0,xs:12,sm:6,md:3,children:S("Total Tests",g.reduce((t,r)=>t+r.totalTests,0),e.jsx(J,{}),"#f6c23e")}),e.jsx(i,{item:!0,xs:12,sm:6,md:3,children:S("Total Revenue",`PKR ${g.reduce((t,r)=>t+r.price,0).toLocaleString()}`,e.jsx(ye,{}),"#e74a3b")})]}),e.jsx(L,{children:e.jsxs(N,{children:[e.jsx(a,{variant:"h6",gutterBottom:!0,children:"All Series"}),e.jsx(ce,{component:de,children:e.jsxs(ue,{children:[e.jsx(xe,{children:e.jsxs(z,{children:[e.jsx(n,{children:"Title"}),e.jsx(n,{children:"Slug"}),e.jsx(n,{children:"Subjects"}),e.jsx(n,{children:"Price"}),e.jsx(n,{children:"Tests"}),e.jsx(n,{children:"Status"}),e.jsx(n,{children:"Actions"})]})}),e.jsx(me,{children:g.map(t=>e.jsxs(z,{children:[e.jsx(n,{children:e.jsxs(j,{display:"flex",alignItems:"center",children:[t.coverImageUrl&&e.jsx("img",{src:t.coverImageUrl,alt:t.title,style:{width:40,height:40,marginRight:10,borderRadius:4}}),e.jsx(a,{variant:"body2",children:t.title})]})}),e.jsx(n,{children:t.slug}),e.jsx(n,{children:t.subjects.map((r,u)=>e.jsx(v,{label:r,size:"small",sx:{mr:.5,mb:.5}},u))}),e.jsxs(n,{children:["PKR ",t.price]}),e.jsx(n,{children:t.totalTests}),e.jsx(n,{children:e.jsx(v,{label:t.isActive?"Active":"Inactive",color:t.isActive?"success":"default",size:"small"})}),e.jsxs(n,{children:[e.jsx(U,{size:"small",onClick:()=>y(t),color:"primary",children:e.jsx(he,{})}),e.jsx(U,{size:"small",onClick:()=>w(t),color:"primary",children:e.jsx(pe,{})}),e.jsx(U,{size:"small",onClick:()=>ie(t._id),color:"error",children:e.jsx(je,{})})]})]},t._id))})]})})]})}),e.jsxs(q,{open:X,onClose:P,maxWidth:"md",fullWidth:!0,children:[e.jsx(O,{children:b?"Edit Series":"Add New Series"}),e.jsx(K,{children:e.jsxs(i,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(x,{fullWidth:!0,label:"Slug",value:s.slug,onChange:t=>l({...s,slug:t.target.value}),error:!!o.slug,helperText:o.slug,placeholder:"e.g., mdcat-series-2025"})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(x,{fullWidth:!0,label:"Title",value:s.title,onChange:t=>l({...s,title:t.target.value}),error:!!o.title,helperText:o.title})}),e.jsxs(i,{item:!0,xs:12,children:[e.jsx(a,{variant:"h6",gutterBottom:!0,children:"Cover Image"}),e.jsx("input",{accept:"image/*",style:{display:"none"},id:"series-image-upload",type:"file",onChange:ee}),e.jsx("label",{htmlFor:"series-image-upload",children:e.jsx(p,{variant:"outlined",component:"span",startIcon:e.jsx(ge,{}),sx:{mb:2},children:"Upload Cover Image"})}),(F||s.coverImageUrl)&&e.jsx(j,{sx:{mt:2},children:e.jsx("img",{src:F||s.coverImageUrl,alt:"Series Cover",style:{maxWidth:"100%",maxHeight:200,borderRadius:8}})})]}),e.jsx(i,{item:!0,xs:12,children:e.jsx(x,{fullWidth:!0,label:"Description",value:s.description,onChange:t=>l({...s,description:t.target.value}),multiline:!0,rows:3,error:!!o.description,helperText:o.description})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsxs(H,{fullWidth:!0,error:!!o.subjects,children:[e.jsx(_,{children:"Subjects"}),e.jsx($,{multiple:!0,value:s.subjects,onChange:re,renderValue:t=>e.jsx(j,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:t.map(r=>e.jsx(v,{label:r,size:"small"},r))}),children:Y.map(t=>e.jsx(G,{value:t,children:t},t))}),o.subjects&&e.jsx(a,{variant:"caption",color:"error",children:o.subjects})]})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsxs(H,{fullWidth:!0,children:[e.jsx(_,{children:"Difficulty"}),e.jsx($,{value:s.difficulty,onChange:t=>l({...s,difficulty:t.target.value}),children:Z.map(t=>e.jsx(G,{value:t,children:t},t))})]})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(x,{fullWidth:!0,label:"Price (PKR)",type:"number",value:s.price,onChange:t=>l({...s,price:t.target.value}),error:!!o.price,helperText:o.price})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(x,{fullWidth:!0,label:"Original Price (PKR)",type:"number",value:s.originalPrice,onChange:t=>l({...s,originalPrice:t.target.value})})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(x,{fullWidth:!0,label:"Total Tests",type:"number",value:s.totalTests,onChange:t=>l({...s,totalTests:t.target.value}),error:!!o.totalTests,helperText:o.totalTests})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(x,{fullWidth:!0,label:"Total Duration (minutes)",type:"number",value:s.totalDurationMin,onChange:t=>l({...s,totalDurationMin:t.target.value})})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(x,{fullWidth:!0,label:"Tags (comma-separated)",value:s.tags.join(","),onChange:le,placeholder:"mdcat, medical, exam"})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsx(x,{fullWidth:!0,label:"Expires At",type:"date",value:s.expiresAt,onChange:t=>l({...s,expiresAt:t.target.value}),InputLabelProps:{shrink:!0}})}),e.jsx(i,{item:!0,xs:12,children:e.jsx(fe,{control:e.jsx(ve,{checked:s.isActive,onChange:t=>l({...s,isActive:t.target.checked})}),label:"Active"})})]})}),e.jsxs(V,{children:[e.jsx(p,{onClick:P,children:"Cancel"}),e.jsx(p,{onClick:se,variant:"contained",disabled:W,sx:{bgcolor:"#4e73df"},children:W?"Saving...":b?"Update":"Create"})]})]}),e.jsx(q,{open:!!c,onClose:()=>y(null),maxWidth:"md",fullWidth:!0,children:c&&e.jsxs(e.Fragment,{children:[e.jsx(O,{children:"Series Details"}),e.jsx(K,{children:e.jsxs(i,{container:!0,spacing:2,children:[e.jsxs(i,{item:!0,xs:12,children:[e.jsx(a,{variant:"h6",children:c.title}),e.jsx(a,{variant:"body2",color:"textSecondary",children:c.slug})]}),e.jsx(i,{item:!0,xs:12,children:e.jsx(a,{variant:"body1",children:c.description})}),e.jsxs(i,{item:!0,xs:12,sm:6,children:[e.jsx(a,{variant:"subtitle2",children:"Subjects:"}),c.subjects.map((t,r)=>e.jsx(v,{label:t,size:"small",sx:{mr:.5,mb:.5}},r))]}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsxs(a,{variant:"subtitle2",children:["Difficulty: ",c.difficulty]})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsxs(a,{variant:"subtitle2",children:["Price: PKR ",c.price]})}),e.jsx(i,{item:!0,xs:12,sm:6,children:e.jsxs(a,{variant:"subtitle2",children:["Total Tests: ",c.totalTests]})}),e.jsxs(i,{item:!0,xs:12,children:[e.jsx(a,{variant:"subtitle2",children:"Tags:"}),(B=c.tags)==null?void 0:B.map((t,r)=>e.jsx(v,{label:t,size:"small",sx:{mr:.5,mb:.5}},r))]})]})}),e.jsxs(V,{children:[e.jsx(p,{onClick:()=>y(null),children:"Close"}),e.jsx(p,{onClick:()=>{y(null),w(c)},variant:"contained",sx:{bgcolor:"#4e73df"},children:"Edit"})]})]})})]})};export{nt as default};
