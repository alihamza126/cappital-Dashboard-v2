import{r as d,j as e}from"./react-BLQlKNq_.js";import{u as he}from"./notistack-DWKSkMQ9.js";import{a as j}from"./index-DmdYNGm4.js";import{F as I,a8 as ue,af as a,v as L,ag as N,b as s,G as W,H as P,J as B,f as E,w as me,P as pe,x as je,j as ve,T as K,a as o,y as ge,B as m,A as fe,a0 as Ie,aj as Ae,I as q,ak as ye,ar as Se,al as Ee,am as Q,an as X,ao as Y,R as Z,ap as ee,aI as be,av as we,aF as Ce,aJ as De}from"./@mui-Bw2wRnxu.js";import"./@babel-HOuxngs4.js";import"./react-dom-DmmE3xc2.js";import"./scheduler-CzFDRTuY.js";import"./goober-DovPBWGu.js";import"./react-router-dom-BCp3cZHX.js";import"./react-router-CeklShVs.js";import"./@remix-run-CbFatO5U.js";import"./react-redux-10GvvXuy.js";import"./use-sync-external-store-De7g8zNk.js";import"./axios-Cm0UX6qg.js";import"./@reduxjs-DVdFRU_h.js";import"./redux-DITMfSWq.js";import"./immer-BWU1mfoO.js";import"./reselect-BeKUwQU7.js";import"./redux-thunk-ClJT1hhx.js";import"./react-typed-DYA10Kre.js";import"./typed.js-exEGtOgn.js";import"./react-bootstrap-sweetalert-DQB2ynYp.js";import"./prop-types-C1xvqhu3.js";import"./swiper-DTKdPQEP.js";import"./fslightbox-react-CQdsEJ3s.js";import"./yet-another-react-lightbox-DocsD2co.js";import"./react-bootstrap-C0bN-j8n.js";import"./classnames-BfIYw_zE.js";import"./@restart-JOvkJ3VN.js";import"./dom-helpers-nL1pTuZz.js";import"./react-transition-group-DSzsIoyj.js";import"./react-lazyload-DZ8paPqQ.js";import"./react-loading-skeleton-D7jF0Q-E.js";import"./@emotion-C2ZuPDAx.js";import"./hoist-non-react-statics-Buxaj0Kl.js";import"./react-is-8JwjhRSi.js";import"./stylis-NkKAe6Bn.js";import"./clsx-B-dksMZM.js";import"./@popperjs-BQBsAJpH.js";const mt=()=>{var H,J,V;const[g,z]=d.useState([]),[u,te]=d.useState([]),[f,se]=d.useState([]),[R,p]=d.useState(!1),[re,$]=d.useState(!1),[A,b]=d.useState(null),[i,y]=d.useState(null),[c,ie]=d.useState(""),[w,ae]=d.useState({}),{enqueueSnackbar:x}=he(),[n,v]=d.useState({userId:"",seriesId:"",activatedAt:"",expiresAt:"",sourceOrderId:""}),[h,C]=d.useState({});d.useEffect(()=>{ne(),le(),T()},[]),d.useEffect(()=>{c?D(c):_()},[c]);const ne=async()=>{try{const t=await j.get("/series/all");te(t.data||[])}catch{x("Failed to fetch series",{variant:"error"})}},le=async()=>{try{const t=await j.get("/user");se(t.data||[]),console.log(t.data)}catch(t){console.log(t),x("Failed to fetch users",{variant:"error"})}},D=async t=>{try{p(!0);const r=await j.get(`/enrollments/series/${t}`);z(r.data||[])}catch{x("Failed to fetch enrollments",{variant:"error"})}finally{p(!1)}},_=async()=>{try{p(!0);const t=await j.get("/enrollments/all");z(t.data||[])}catch{x("Failed to fetch enrollments",{variant:"error"})}finally{p(!1)}},T=async()=>{try{const t=await j.get("/enrollments/stats/overview");ae(t.data||[])}catch{x("Failed to fetch statistics",{variant:"error"})}},k=(t=null)=>{t?(b(t),v({userId:t.userId._id||t.userId,seriesId:t.seriesId._id||t.seriesId,activatedAt:t.activatedAt?new Date(t.activatedAt).toISOString().split("T")[0]:"",expiresAt:t.expiresAt?new Date(t.expiresAt).toISOString().split("T")[0]:"",sourceOrderId:t.sourceOrderId._id||t.sourceOrderId})):(b(null),v({userId:"",seriesId:c||"",activatedAt:new Date().toISOString().split("T")[0],expiresAt:"",sourceOrderId:""})),C({}),$(!0)},F=()=>{$(!1),b(null),C({})},oe=()=>{const t={};return n.userId||(t.userId="User is required"),n.seriesId||(t.seriesId="Series is required"),n.activatedAt||(t.activatedAt="Activation date is required"),C(t),Object.keys(t).length===0},de=async()=>{var t,r;if(oe())try{p(!0);const l={...n,activatedAt:new Date(n.activatedAt),expiresAt:n.expiresAt?new Date(n.expiresAt):void 0};A?(await j.put(`/enrollments/${A._id}`,l),x("Enrollment updated successfully",{variant:"success"})):(await j.post("/enrollments",l),x("Enrollment created successfully",{variant:"success"})),F(),c?D(c):_(),T()}catch(l){x(((r=(t=l.response)==null?void 0:t.data)==null?void 0:r.error)||"Operation failed",{variant:"error"})}finally{p(!1)}},ce=async t=>{if(window.confirm("Are you sure you want to delete this enrollment? This action cannot be undone."))try{p(!0),await j.delete(`/enrollments/${t}`),x("Enrollment deleted successfully",{variant:"success"}),c?D(c):_(),T()}catch{x("Failed to delete enrollment",{variant:"error"})}finally{p(!1)}},S=(t,r,l,xe)=>e.jsx(L,{sx:{minWidth:275,bgcolor:xe},children:e.jsx(N,{children:e.jsxs(m,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs(m,{children:[e.jsx(s,{variant:"h6",component:"div",color:"white",children:t}),e.jsx(s,{variant:"h4",component:"div",color:"white",children:r})]}),e.jsx(m,{color:"white",children:l})]})})}),M=t=>t.expiresAt?new Date(t.expiresAt)<new Date:!1,O=t=>{const r=f.find(l=>l._id===t);return r?r.username:"Unknown User"},G=t=>{const r=f.find(l=>l._id===t);return r?r.email:"Unknown Email"},U=t=>{const r=u.find(l=>l._id===t);return r?r.title:"Unknown Series"};return e.jsxs("div",{className:"container-fluid",children:[e.jsxs("div",{className:"d-sm-flex align-items-center justify-content-between mb-4",children:[e.jsx("h1",{className:"h3 mb-0 text-gray-800",children:"Enrollment Management"}),e.jsx(I,{variant:"contained",startIcon:e.jsx(ue,{}),onClick:()=>k(),sx:{bgcolor:"#4e73df"},children:"Add New Enrollment"})]}),e.jsxs(a,{container:!0,spacing:3,sx:{mb:4},children:[e.jsx(a,{item:!0,xs:12,sm:6,md:3,children:S("Total Enrollments",w.totalEnrollments||0,e.jsx(be,{}),"#4e73df")}),e.jsx(a,{item:!0,xs:12,sm:6,md:3,children:S("Active Enrollments",w.activeEnrollments||0,e.jsx(we,{}),"#1cc88a")}),e.jsx(a,{item:!0,xs:12,sm:6,md:3,children:S("Expired Enrollments",w.expiredEnrollments||0,e.jsx(Ce,{}),"#f6c23e")}),e.jsx(a,{item:!0,xs:12,sm:6,md:3,children:S("Current Enrollments",g.length,e.jsx(De,{}),"#e74a3b")})]}),e.jsx(L,{sx:{mb:4},children:e.jsxs(N,{children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Filter by Series"}),e.jsxs(W,{fullWidth:!0,children:[e.jsx(P,{children:"Choose Series"}),e.jsxs(B,{value:c,onChange:t=>ie(t.target.value),children:[e.jsx(E,{value:"",children:"All Series"}),u&&(u==null?void 0:u.map(t=>e.jsx(E,{value:t._id,children:t.title},t._id)))]})]})]})}),e.jsx(L,{children:e.jsxs(N,{children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:c?`Enrollments for ${U(c)}`:"All Enrollments"}),e.jsx(me,{component:pe,children:e.jsxs(je,{children:[e.jsx(ve,{children:e.jsxs(K,{children:[e.jsx(o,{children:"Student"}),e.jsx(o,{children:"Series"}),e.jsx(o,{children:"Activated"}),e.jsx(o,{children:"Expires"}),e.jsx(o,{children:"Progress"}),e.jsx(o,{children:"Status"}),e.jsx(o,{children:"Actions"})]})}),e.jsx(ge,{children:g&&(g==null?void 0:g.map(t=>{var r,l;return e.jsxs(K,{children:[e.jsx(o,{children:e.jsxs(m,{display:"flex",alignItems:"center",children:[e.jsx(fe,{sx:{mr:2,width:32,height:32},children:O(t.userId._id||t.userId).charAt(0).toUpperCase()}),e.jsxs(m,{children:[e.jsx(s,{variant:"body2",children:O(t.userId._id||t.userId)}),e.jsx(s,{variant:"caption",color:"textSecondary",children:G(t.userId._id||t.userId)})]})]})}),e.jsx(o,{children:e.jsx(s,{variant:"body2",children:U(t.seriesId._id||t.seriesId)})}),e.jsx(o,{children:new Date(t.activatedAt).toLocaleDateString()}),e.jsx(o,{children:t.expiresAt?new Date(t.expiresAt).toLocaleDateString():"No Expiry"}),e.jsx(o,{children:e.jsxs(m,{sx:{width:"100%"},children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(m,{sx:{width:"100%",mr:1},children:e.jsx(Ie,{variant:"determinate",value:((r=t.progress)==null?void 0:r.testsAttempted)||0,sx:{height:8,borderRadius:5}})}),e.jsx(m,{sx:{minWidth:35},children:e.jsx(s,{variant:"body2",color:"text.secondary",children:((l=t.progress)==null?void 0:l.testsAttempted)||0})})]}),e.jsx(s,{variant:"caption",color:"textSecondary",children:"Tests attempted"})]})}),e.jsx(o,{children:e.jsx(Ae,{label:M(t)?"Expired":"Active",color:M(t)?"error":"success",size:"small"})}),e.jsxs(o,{children:[e.jsx(q,{size:"small",onClick:()=>y(t),color:"primary",children:e.jsx(ye,{})}),e.jsx(q,{size:"small",onClick:()=>k(t),color:"primary",children:e.jsx(Se,{})}),e.jsx(q,{size:"small",onClick:()=>ce(t._id),color:"error",children:e.jsx(Ee,{})})]})]},t._id)}))})]})})]})}),e.jsxs(Q,{open:re,onClose:F,maxWidth:"md",fullWidth:!0,children:[e.jsx(X,{children:A?"Edit Enrollment":"Add New Enrollment"}),e.jsx(Y,{children:e.jsxs(a,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsxs(W,{fullWidth:!0,error:!!h.userId,children:[e.jsx(P,{children:"User"}),e.jsx(B,{value:n.userId,onChange:t=>v({...n,userId:t.target.value}),children:f==null?void 0:f.map(t=>e.jsxs(E,{value:t._id,children:[t.username," (",t.email,")"]},t._id))}),(h==null?void 0:h.userId)&&e.jsx(s,{variant:"caption",color:"error",children:h.userId})]})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsxs(W,{fullWidth:!0,error:!!h.seriesId,children:[e.jsx(P,{children:"Series"}),e.jsx(B,{value:n.seriesId,onChange:t=>v({...n,seriesId:t.target.value}),children:u&&(u==null?void 0:u.map(t=>e.jsx(E,{value:t._id,children:t.title},t._id)))}),h.seriesId&&e.jsx(s,{variant:"caption",color:"error",children:h.seriesId})]})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(Z,{fullWidth:!0,label:"Activated At",type:"date",value:n.activatedAt,onChange:t=>v({...n,activatedAt:t.target.value}),error:!!h.activatedAt,helperText:h.activatedAt,InputLabelProps:{shrink:!0}})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsx(Z,{fullWidth:!0,label:"Expires At (Optional)",type:"date",value:n.expiresAt,onChange:t=>v({...n,expiresAt:t.target.value}),InputLabelProps:{shrink:!0}})})]})}),e.jsxs(ee,{children:[e.jsx(I,{onClick:F,children:"Cancel"}),e.jsx(I,{onClick:de,variant:"contained",disabled:R,sx:{bgcolor:"#4e73df"},children:R?"Saving...":A?"Update":"Create"})]})]}),e.jsx(Q,{open:!!i,onClose:()=>y(null),maxWidth:"md",fullWidth:!0,children:i&&e.jsxs(e.Fragment,{children:[e.jsx(X,{children:"Enrollment Details"}),e.jsx(Y,{children:e.jsxs(a,{container:!0,spacing:2,children:[e.jsxs(a,{item:!0,xs:12,children:[e.jsx(s,{variant:"h6",children:"Student Information"}),e.jsxs(s,{variant:"body2",children:["Name: ",O(i.userId._id||i.userId)]}),e.jsxs(s,{variant:"body2",children:["Email: ",G(i.userId._id||i.userId)]})]}),e.jsxs(a,{item:!0,xs:12,children:[e.jsx(s,{variant:"h6",children:"Series Information"}),e.jsxs(s,{variant:"body2",children:["Series: ",U(i.seriesId._id||i.seriesId)]})]}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsxs(s,{variant:"subtitle2",children:["Activated: ",new Date(i.activatedAt).toLocaleDateString()]})}),e.jsx(a,{item:!0,xs:12,sm:6,children:e.jsxs(s,{variant:"subtitle2",children:["Expires: ",i.expiresAt?new Date(i.expiresAt).toLocaleDateString():"No Expiry"]})}),e.jsxs(a,{item:!0,xs:12,children:[e.jsx(s,{variant:"h6",children:"Progress"}),e.jsxs(s,{variant:"body2",children:["Tests Attempted: ",((H=i.progress)==null?void 0:H.testsAttempted)||0]}),e.jsxs(s,{variant:"body2",children:["Average Score: ",((J=i.progress)==null?void 0:J.avgScore)||"N/A"]}),e.jsxs(s,{variant:"body2",children:["Last Attempt: ",(V=i.progress)!=null&&V.lastAttemptAt?new Date(i.progress.lastAttemptAt).toLocaleDateString():"No attempts yet"]})]})]})}),e.jsxs(ee,{children:[e.jsx(I,{onClick:()=>y(null),children:"Close"}),e.jsx(I,{onClick:()=>{y(null),k(i)},variant:"contained",sx:{bgcolor:"#4e73df"},children:"Edit"})]})]})})]})};export{mt as default};
