import{r as m,j as e}from"./react-BLQlKNq_.js";import{u as U,a as A}from"./react-redux-10GvvXuy.js";import{a as f,i as W}from"./index-CAcQg_82.js";import{u as z,c as R}from"./notistack-DWKSkMQ9.js";import{t as O,b as x,az as E,I as j,b0 as B,af as l,A as L,R as c,F as _,i as M}from"./@mui-Bw2wRnxu.js";import{m as T}from"./framer-motion-BtSPSV2p.js";import{S as q}from"./react-bootstrap-C0bN-j8n.js";import"./@babel-HOuxngs4.js";import"./use-sync-external-store-De7g8zNk.js";import"./react-dom-DmmE3xc2.js";import"./scheduler-CzFDRTuY.js";import"./react-router-dom-BCp3cZHX.js";import"./react-router-CeklShVs.js";import"./@remix-run-CbFatO5U.js";import"./axios-Cm0UX6qg.js";import"./@reduxjs-DVdFRU_h.js";import"./redux-DITMfSWq.js";import"./immer-BWU1mfoO.js";import"./reselect-BeKUwQU7.js";import"./redux-thunk-ClJT1hhx.js";import"./react-typed-DYA10Kre.js";import"./typed.js-exEGtOgn.js";import"./react-bootstrap-sweetalert-DQB2ynYp.js";import"./prop-types-C1xvqhu3.js";import"./swiper-DTKdPQEP.js";import"./fslightbox-react-CQdsEJ3s.js";import"./yet-another-react-lightbox-DocsD2co.js";import"./react-lazyload-DZ8paPqQ.js";import"./react-loading-skeleton-D7jF0Q-E.js";import"./goober-DovPBWGu.js";import"./@emotion-C2ZuPDAx.js";import"./hoist-non-react-statics-Buxaj0Kl.js";import"./react-is-8JwjhRSi.js";import"./stylis-NkKAe6Bn.js";import"./clsx-B-dksMZM.js";import"./react-transition-group-DSzsIoyj.js";import"./@popperjs-BQBsAJpH.js";import"./classnames-BfIYw_zE.js";import"./@restart-JOvkJ3VN.js";import"./dom-helpers-nL1pTuZz.js";const ke=()=>{const[p,y]=m.useState(null),[C,d]=m.useState(!1),b=U(),{user:t=""}=A(r=>{var i,n;return((n=(i=r.auth)==null?void 0:i.user)==null?void 0:n.user)||""}),[u,N]=m.useState(t.profileUrl||""),v=t.aggPercentage<1||t.domicalCity=="",[w,S]=m.useState(v),{enqueueSnackbar:P}=z(),D=(r,i)=>{P(r,{variant:i,autoHideDuration:2200,anchorOrigin:{vertical:"top",horizontal:"center"},action:e.jsx(j,{size:"small","aria-label":"close",color:"inherit",onClick:()=>R(),children:e.jsx(M,{fontSize:"small"})})})},[a,I]=m.useState({fullName:t.fullname||"",fName:t.fathername||"",email:t.email||"",city:t.city||"",contact:t.contact||"",course:t.course||"",domicalCity:(t==null?void 0:t.domicalCity)||"",aggPercentage:(t==null?void 0:t.aggPercentage)||""}),s=r=>{I({...a,[r.target.name]:r.target.value})},h=async r=>{r.preventDefault();try{d(!0);const i={id:t._id};a.fullName!==t.fullname&&(i.fullname=a.fullName),a.fName!==t.fathername&&(i.fathername=a.fName),a.email!==t.email&&(i.email=a.email),a.city!==t.city&&(i.city=a.city),a.contact!==t.contact&&(i.contact=a.contact),a.domicalCity!==t.domicalCity&&(i.domicalCity=a.domicalCity),a.aggPercentage!==t.aggPercentage&&(i.aggPercentage=a.aggPercentage);let n=t.profileUrl;if(p){const o=new FormData;o.append("image",p);const k={headers:{"Content-Type":"multipart/form-data"}},g=await f.post("/upload/img",o,k);if(g.status===200)n=g.data.fileURL;else throw new Error("Failed to upload image")}i.profileUrl=n;try{const o=await f.post("/user/update",i);o.data.user!=null?(localStorage.setItem("user",JSON.stringify(o.data)),b(W(o.data)),window.location.reload()):o.data.code==11e3&&D("Email Already Registered","error")}catch{}d(!1)}catch{d(!1)}},F=r=>{const i=r.target.files[0],n=new FileReader;n.onload=()=>{N(n.result)},n.readAsDataURL(i),y(i)};return e.jsxs(O,{maxWidth:"xl",children:[e.jsx("div",{className:"container text-center py-2 mt-md-1 mt-4 rounded-5 shadow text-white fw-bold custom-bg",children:e.jsx(x,{variant:"h5",className:"mt-2 d-inline",align:"center",gutterBottom:!0,children:"Profile Settings"})}),w&&e.jsx(T.div,{initial:{opacity:0,x:50},transition:{duration:1},whileInView:{opacity:1,x:0},children:e.jsxs(E,{className:"mt-4",variant:"filled",severity:"info",action:e.jsx(j,{"aria-label":"close",color:"inherit",size:"small",onClick:()=>{S(!1)},children:e.jsx(B,{fontSize:"inherit"})}),children:[e.jsx("p",{children:"Please provide the following details:"}),e.jsxs("ol",{children:[(t==null?void 0:t.domicalCity)==""&&e.jsx("li",{children:"Domicile City"}),((t==null?void 0:t.aggPercentage)<1||(t==null?void 0:t.aggPercentage)==null)&&e.jsx("li",{children:"Aggregate Marks Percentage"})]})]})}),e.jsxs("div",{className:"row py-5",children:[e.jsx("div",{className:"col-md-4 col-12 mb-4",children:e.jsx(l,{container:!0,justifyContent:"center",className:"custom-shodow rounded-5",children:e.jsxs("div",{className:"p-5",children:[e.jsx(L,{sx:{width:170,height:170,marginBottom:2},src:u==null?void 0:u.replace("/upload/","/upload/w_200,h_200,c_fill/"),alt:"Profile Image"}),e.jsxs("div",{className:"row justify-content-center",children:[e.jsx("input",{id:"file",type:"file",hidden:!0,accept:"image/*",onChange:F}),e.jsx("label",{htmlFor:"file",name:"file",className:"d-flex justify-content-center",children:e.jsx("span",{className:"btn btn-primary btn-sm w-75 ",children:"Change Image"})})]}),e.jsxs(x,{className:"mt-4 text-center fw-bold text-primary",children:["Username:",e.jsxs("span",{className:"d-block bg-light py-1 rounded-2 text-gray-600 fw",children:["@ ",t.username]})]})]})})}),e.jsx("div",{className:"col-md-8 col-12 shadow rounded-4 px-5 py-5",children:e.jsx("form",{onSubmit:h,children:e.jsxs(l,{container:!0,spacing:2,children:[e.jsx(l,{item:!0,xs:6,children:e.jsx(c,{fullWidth:!0,label:"Full Name",name:"fullName",value:a.fullName,onChange:s})}),e.jsx(l,{item:!0,xs:6,children:e.jsx(c,{fullWidth:!0,label:"Father Name",name:"fName",value:a.fName,onChange:s})}),e.jsx(l,{item:!0,xs:12,children:e.jsx(c,{fullWidth:!0,label:"Email",name:"email",inputMode:"email",type:"email",required:!0,value:a.email,onChange:s})}),e.jsx(l,{item:!0,xs:12,children:e.jsx(c,{fullWidth:!0,label:"City",name:"city",value:a.city,onChange:s})}),e.jsx(l,{item:!0,xs:12,children:e.jsx(c,{fullWidth:!0,label:"Contact Number",name:"contact",value:a.contact,onChange:s})}),e.jsx(l,{item:!0,xs:6,children:e.jsx(c,{fullWidth:!0,label:"Aggregate Percentage",name:"aggPercentage",inputMode:"numeric",type:"number",value:a.aggPercentage,onChange:s})}),e.jsx(l,{item:!0,xs:6,children:e.jsx(c,{fullWidth:!0,label:"Domical City",name:"domicalCity",value:a.domicalCity,onChange:s})}),e.jsx(l,{item:!0,xs:12,children:e.jsxs(_,{type:"submit",onClick:h,variant:"contained",color:"primary",children:[" ","Update ",C&&e.jsx(q,{className:"ms-1",size:"sm"})]})})]})})})]})]})};export{ke as default};
